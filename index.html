<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Zuri Love - Complete Dating Web App</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/@emailjs/browser@3/dist/email.min.js"></script>
    <style>
        .gradient-bg {
            background: linear-gradient(135deg, #fce7f3 0%, #f3e8ff 50%, #e0e7ff 100%);
        }
        .gradient-text {
            background: linear-gradient(135deg, #ec4899, #8b5cf6);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }
        .gradient-button {
            background: linear-gradient(135deg, #ec4899, #8b5cf6);
        }
        .gradient-button:hover {
            background: linear-gradient(135deg, #db2777, #7c3aed);
        }
        .modal-overlay {
            background-color: rgba(0, 0, 0, 0.5);
        }
        .notification-badge {
            animation: pulse 2s infinite;
        }
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }
        .online-dot {
            animation: pulse 2s infinite;
        }
        .card-hover {
            transition: all 0.3s ease;
        }
        .card-hover:hover {
            transform: translateY(-4px);
            box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04);
        }
        .line-clamp-2 {
            overflow: hidden;
            display: -webkit-box;
            -webkit-box-orient: vertical;
            -webkit-line-clamp: 2;
        }
        .dropdown-menu {
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.3s ease;
        }
        .dropdown-menu.open {
            max-height: 400px;
        }
    </style>
</head>
<body class="bg-gray-50">
    <div id="app"></div>

    <script>
        // Initialize EmailJS
        emailjs.init('LMdaXNTSTm33O5BqT');

        // Global state
        let currentUser = null;
        let currentView = 'auth';
        let selectedMatch = null;
        let showBuyCredits = false;
        let showNotifications = false;
        let showUserMenu = false;
        let showTransactionHistory = false;
        let showSupport = false;
        let showProfileSettings = false;
        let currentMessage = '';
        let matches = [];
        let notifications = [];
        let transactions = [];
        let isLogin = true;
        let showPassword = false;
        let showCountryDropdown = false;
        let showCurrencyDropdown = false;
        let selectedPackage = null;
        let selectedCurrency = { code: 'USD', name: 'US Dollar', symbol: '$', rate: 1 };
        let showPayment = false;
        let showSuccess = false;
        let transactionId = '';
        let error = '';
        let profileImage = '';
        let isEditing = false;
        let showAlert = false;
        let alertMessage = '';
        let alertType = 'info';
        let chatMessages = [];

        // Form data
        let formData = {
            email: '',
            password: '',
            name: '',
            age: '',
            height: '',
            country: '',
            countryCode: '',
            phoneNumber: '',
            relationshipStatus: '',
            lookingFor: '',
            relationshipType: '',
            sex: '',
        };

        let editFormData = {
            name: '',
            age: '',
            height: '',
            country: '',
        };

        // Constants
        const CURRENCIES = [
            { code: 'USD', name: 'US Dollar', symbol: '$', rate: 1 },
            { code: 'EUR', name: 'Euro', symbol: '€', rate: 0.85 },
            { code: 'GBP', name: 'British Pound', symbol: '£', rate: 0.73 },
            { code: 'KES', name: 'Kenyan Shilling', symbol: 'KSh', rate: 129.50 },
            { code: 'NGN', name: 'Nigerian Naira', symbol: '₦', rate: 461.50 },
            { code: 'ZAR', name: 'South African Rand', symbol: 'R', rate: 18.75 },
            { code: 'GHS', name: 'Ghanaian Cedi', symbol: '₵', rate: 12.15 },
            { code: 'UGX', name: 'Ugandan Shilling', symbol: 'USh', rate: 3720 },
            { code: 'TZS', name: 'Tanzanian Shilling', symbol: 'TSh', rate: 2340 },
            { code: 'RWF', name: 'Rwandan Franc', symbol: 'RF', rate: 1025 },
            { code: 'ETB', name: 'Ethiopian Birr', symbol: 'Br', rate: 55.25 },
            { code: 'EGP', name: 'Egyptian Pound', symbol: 'E£', rate: 30.85 },
            { code: 'MAD', name: 'Moroccan Dirham', symbol: 'DH', rate: 10.15 },
            { code: 'INR', name: 'Indian Rupee', symbol: '₹', rate: 83.25 },
            { code: 'CNY', name: 'Chinese Yuan', symbol: '¥', rate: 7.25 },
            { code: 'JPY', name: 'Japanese Yen', symbol: '¥', rate: 149.50 },
            { code: 'AUD', name: 'Australian Dollar', symbol: 'A$', rate: 1.52 },
            { code: 'CAD', name: 'Canadian Dollar', symbol: 'C$', rate: 1.36 },
        ];

        const COUNTRIES = [
            { name: 'Afghanistan', code: 'AF', dialCode: '+93' },
            { name: 'Albania', code: 'AL', dialCode: '+355' },
            { name: 'Algeria', code: 'DZ', dialCode: '+213' },
            { name: 'Argentina', code: 'AR', dialCode: '+54' },
            { name: 'Australia', code: 'AU', dialCode: '+61' },
            { name: 'Austria', code: 'AT', dialCode: '+43' },
            { name: 'Bangladesh', code: 'BD', dialCode: '+880' },
            { name: 'Belgium', code: 'BE', dialCode: '+32' },
            { name: 'Brazil', code: 'BR', dialCode: '+55' },
            { name: 'Canada', code: 'CA', dialCode: '+1' },
            { name: 'China', code: 'CN', dialCode: '+86' },
            { name: 'Denmark', code: 'DK', dialCode: '+45' },
            { name: 'Egypt', code: 'EG', dialCode: '+20' },
            { name: 'Ethiopia', code: 'ET', dialCode: '+251' },
            { name: 'France', code: 'FR', dialCode: '+33' },
            { name: 'Germany', code: 'DE', dialCode: '+49' },
            { name: 'Ghana', code: 'GH', dialCode: '+233' },
            { name: 'India', code: 'IN', dialCode: '+91' },
            { name: 'Indonesia', code: 'ID', dialCode: '+62' },
            { name: 'Iran', code: 'IR', dialCode: '+98' },
            { name: 'Iraq', code: 'IQ', dialCode: '+964' },
            { name: 'Israel', code: 'IL', dialCode: '+972' },
            { name: 'Italy', code: 'IT', dialCode: '+39' },
            { name: 'Japan', code: 'JP', dialCode: '+81' },
            { name: 'Jordan', code: 'JO', dialCode: '+962' },
            { name: 'Kenya', code: 'KE', dialCode: '+254' },
            { name: 'Kuwait', code: 'KW', dialCode: '+965' },
            { name: 'Lebanon', code: 'LB', dialCode: '+961' },
            { name: 'Malaysia', code: 'MY', dialCode: '+60' },
            { name: 'Mexico', code: 'MX', dialCode: '+52' },
            { name: 'Morocco', code: 'MA', dialCode: '+212' },
            { name: 'Netherlands', code: 'NL', dialCode: '+31' },
            { name: 'Nigeria', code: 'NG', dialCode: '+234' },
            { name: 'Norway', code: 'NO', dialCode: '+47' },
            { name: 'Pakistan', code: 'PK', dialCode: '+92' },
            { name: 'Philippines', code: 'PH', dialCode: '+63' },
            { name: 'Poland', code: 'PL', dialCode: '+48' },
            { name: 'Qatar', code: 'QA', dialCode: '+974' },
            { name: 'Russia', code: 'RU', dialCode: '+7' },
            { name: 'Rwanda', code: 'RW', dialCode: '+250' },
            { name: 'Saudi Arabia', code: 'SA', dialCode: '+966' },
            { name: 'Singapore', code: 'SG', dialCode: '+65' },
            { name: 'South Africa', code: 'ZA', dialCode: '+27' },
            { name: 'South Korea', code: 'KR', dialCode: '+82' },
            { name: 'Spain', code: 'ES', dialCode: '+34' },
            { name: 'Sri Lanka', code: 'LK', dialCode: '+94' },
            { name: 'Sweden', code: 'SE', dialCode: '+46' },
            { name: 'Switzerland', code: 'CH', dialCode: '+41' },
            { name: 'Tanzania', code: 'TZ', dialCode: '+255' },
            { name: 'Thailand', code: 'TH', dialCode: '+66' },
            { name: 'Turkey', code: 'TR', dialCode: '+90' },
            { name: 'Uganda', code: 'UG', dialCode: '+256' },
            { name: 'Ukraine', code: 'UA', dialCode: '+380' },
            { name: 'United Arab Emirates', code: 'AE', dialCode: '+971' },
            { name: 'United Kingdom', code: 'GB', dialCode: '+44' },
            { name: 'United States', code: 'US', dialCode: '+1' },
            { name: 'Vietnam', code: 'VN', dialCode: '+84' },
        ];

        const CREDIT_PACKAGES = [
            {
                id: '1',
                name: '10 Credits',
                credits: 10,
                priceUSD: 1,
                isUnlimited: false,
            },
            {
                id: '2',
                name: 'Unlimited Messages (1 Month)',
                credits: 0,
                priceUSD: 5,
                isUnlimited: true,
                duration: 30,
            },
            {
                id: '3',
                name: 'Unlimited Messages (1 Month Premium)',
                credits: 0,
                priceUSD: 10,
                isUnlimited: true,
                duration: 30,
            },
        ];

        const FAKE_MATCHES = [
            {
                id: '1',
                name: 'Emma Rodriguez',
                age: 26,
                country: 'Spain',
                sex: 'female',
                profileImage: 'https://images.pexels.com/photos/1239291/pexels-photo-1239291.jpeg?auto=compress&cs=tinysrgb&w=300&h=400&fit=crop',
                isOnline: true,
                lastMessage: 'Hey there! How are you?',
                unreadCount: 2,
                lastActivity: Date.now() - 300000,
                hasLiked: false,
            },
            {
                id: '2',
                name: 'Sophie Chen',
                age: 24,
                country: 'Canada',
                sex: 'female',
                profileImage: 'https://images.pexels.com/photos/1222271/pexels-photo-1222271.jpeg?auto=compress&cs=tinysrgb&w=300&h=400&fit=crop',
                isOnline: true,
                lastMessage: 'Nice to meet you!',
                unreadCount: 1,
                lastActivity: Date.now() - 600000,
                hasLiked: true,
            },
            {
                id: '3',
                name: 'Isabella Santos',
                age: 28,
                country: 'Brazil',
                sex: 'female',
                profileImage: 'https://images.pexels.com/photos/1024311/pexels-photo-1024311.jpeg?auto=compress&cs=tinysrgb&w=300&h=400&fit=crop',
                isOnline: false,
                lastMessage: 'Hope to hear from you soon!',
                unreadCount: 0,
                lastActivity: Date.now() - 1800000,
                hasLiked: false,
            },
            {
                id: '4',
                name: 'James Wilson',
                age: 29,
                country: 'United States',
                sex: 'male',
                profileImage: 'https://images.pexels.com/photos/1043474/pexels-photo-1043474.jpeg?auto=compress&cs=tinysrgb&w=300&h=400&fit=crop',
                isOnline: true,
                lastMessage: 'Hey! How\'s your day going?',
                unreadCount: 1,
                lastActivity: Date.now() - 450000,
                hasLiked: false,
            },
            {
                id: '5',
                name: 'Carlos Martinez',
                age: 31,
                country: 'Mexico',
                sex: 'male',
                profileImage: 'https://images.pexels.com/photos/1040880/pexels-photo-1040880.jpeg?auto=compress&cs=tinysrgb&w=300&h=400&fit=crop',
                isOnline: true,
                lastMessage: 'Nice profile!',
                unreadCount: 2,
                lastActivity: Date.now() - 750000,
                hasLiked: true,
            },
            {
                id: '6',
                name: 'Ahmed Hassan',
                age: 27,
                country: 'Egypt',
                sex: 'male',
                profileImage: 'https://images.pexels.com/photos/1043473/pexels-photo-1043473.jpeg?auto=compress&cs=tinysrgb&w=300&h=400&fit=crop',
                isOnline: false,
                lastMessage: 'Looking forward to getting to know you',
                unreadCount: 0,
                lastActivity: Date.now() - 1500000,
                hasLiked: false,
            },
        ];

        // Storage functions
        function getCurrentUser() {
            const user = localStorage.getItem('zuri_current_user');
            return user ? JSON.parse(user) : null;
        }

        function setCurrentUser(user) {
            if (user) {
                localStorage.setItem('zuri_current_user', JSON.stringify(user));
            } else {
                localStorage.removeItem('zuri_current_user');
            }
        }

        function getUsers() {
            const users = localStorage.getItem('zuri_users');
            return users ? JSON.parse(users) : [];
        }

        function setUsers(users) {
            localStorage.setItem('zuri_users', JSON.stringify(users));
        }

        function getNotifications() {
            const notifications = localStorage.getItem('zuri_notifications');
            return notifications ? JSON.parse(notifications) : [];
        }

        function setNotifications(notifs) {
            localStorage.setItem('zuri_notifications', JSON.stringify(notifs));
        }

        function getTransactions() {
            const transactions = localStorage.getItem('zuri_transactions');
            return transactions ? JSON.parse(transactions) : [];
        }

        function setTransactions(trans) {
            localStorage.setItem('zuri_transactions', JSON.stringify(trans));
        }

        // Utility functions
        function hasCreditsOrUnlimited() {
            if (!currentUser) return false;
            
            if (currentUser.hasUnlimitedMessages && 
                currentUser.unlimitedUntil && 
                currentUser.unlimitedUntil > Date.now()) {
                return true;
            }
            return currentUser.credits > 0;
        }

        function getLocalPrice(pkg) {
            return (pkg.priceUSD * selectedCurrency.rate).toFixed(2);
        }

        function formatDate(timestamp) {
            return new Date(timestamp).toLocaleDateString();
        }

        function formatTime(timestamp) {
            return new Date(timestamp).toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'});
        }

        // Email functions
        async function sendRegistrationEmail(userData) {
            try {
                const templateParams = {
                    user_name: userData.name,
                    user_email: userData.email,
                    user_age: userData.age,
                    user_height: userData.height,
                    user_country: userData.country,
                    user_phone: userData.countryCode + userData.phoneNumber,
                    user_sex: userData.sex,
                    relationship_status: userData.relationshipStatus,
                    looking_for: userData.lookingFor,
                    relationship_type: userData.relationshipType,
                };

                await emailjs.send(
                    'service_7e51cwp',
                    'template_sf4bm9j',
                    templateParams,
                    'LMdaXNTSTm33O5BqT'
                );
            } catch (error) {
                console.error('Failed to send registration email:', error);
            }
        }

        async function sendPaymentEmail(user, packageData, amount, transactionId, currency) {
            try {
                const templateParams = {
                    user_name: user.name,
                    user_email: user.email,
                    user_phone: user.countryCode + user.phoneNumber,
                    package_name: packageData.name,
                    amount_paid: `${currency.symbol}${amount}`,
                    transaction_id: transactionId,
                    currency: currency.code,
                };

                await emailjs.send(
                    'service_7e51cwp',
                    'template_6rl4ss2',
                    templateParams,
                    'LMdaXNTSTm33O5BqT'
                );
            } catch (error) {
                console.error('Failed to send payment email:', error);
            }
        }

        // Event handlers
        function handleLogin(e) {
            e.preventDefault();
            error = '';

            const trimmedEmail = formData.email.trim();
            const trimmedPassword = formData.password.trim();

            if (!trimmedEmail) {
                showAlertModal('Email address is required', 'error');
                return;
            }

            if (!trimmedPassword) {
                showAlertModal('Password is required', 'error');
                return;
            }

            const users = getUsers();

            if (isLogin) {
                const user = users.find(u => u.email === trimmedEmail && u.password === trimmedPassword);
                if (user) {
                    currentUser = user;
                    setCurrentUser(user);
                    currentView = 'main';
                    initializeApp();
                } else {
                    showAlertModal('Invalid email or password', 'error');
                }
            } else {
                if (users.find(u => u.email === trimmedEmail)) {
                    showAlertModal('Email already exists', 'error');
                    return;
                }

                const newUser = {
                    id: Date.now().toString(),
                    email: trimmedEmail,
                    password: trimmedPassword,
                    name: formData.name.trim(),
                    age: parseInt(formData.age),
                    height: formData.height.trim(),
                    country: formData.country,
                    countryCode: formData.countryCode,
                    phoneNumber: formData.phoneNumber.trim(),
                    relationshipStatus: formData.relationshipStatus,
                    lookingFor: formData.lookingFor,
                    relationshipType: formData.relationshipType,
                    sex: formData.sex,
                    profileImage,
                    credits: 5,
                    isOnline: true,
                };

                users.push(newUser);
                setUsers(users);
                
                sendRegistrationEmail(newUser);
                currentUser = newUser;
                setCurrentUser(newUser);
                currentView = 'main';
                initializeApp();
            }
            render();
        }

        function handleImageUpload(e) {
            const file = e.target.files?.[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = (e) => {
                    if (currentView === 'auth') {
                        profileImage = e.target.result;
                    } else {
                        editFormData.profileImage = e.target.result;
                    }
                    render();
                };
                reader.readAsDataURL(file);
            }
        }

        function handleCountrySelect(countryName) {
            const country = COUNTRIES.find(c => c.name === countryName);
            if (country) {
                formData.country = country.name;
                formData.countryCode = country.dialCode;
                showCountryDropdown = false;
                render();
            }
        }

        function handleCurrencySelect(currencyCode) {
            const currency = CURRENCIES.find(c => c.code === currencyCode);
            if (currency) {
                selectedCurrency = currency;
                showCurrencyDropdown = false;
                render();
            }
        }

        function handlePackageSelect(pkg) {
            selectedPackage = pkg;
            showPayment = true;
            render();
        }

        async function handlePayment() {
            if (!transactionId.trim()) {
                error = 'Please enter transaction ID';
                render();
                return;
            }

            error = '';
            // Simple validation - in real app, this would verify with payment provider
            if (transactionId.length >= 8) {
                let updatedUser = { ...currentUser };
                
                if (selectedPackage.id === '1') {
                    updatedUser.credits = currentUser.credits + 10;
                } else if (selectedPackage.id === '2' || selectedPackage.id === '3') {
                    updatedUser.hasUnlimitedMessages = true;
                    updatedUser.unlimitedUntil = Date.now() + (30 * 24 * 60 * 60 * 1000); // 30 days
                }
                
                currentUser = updatedUser;
                setCurrentUser(updatedUser);
                
                // Update users array
                const users = getUsers();
                const updatedUsers = users.map(u => u.id === updatedUser.id ? updatedUser : u);
                setUsers(updatedUsers);

                // Add transaction record
                const newTransaction = {
                    id: Date.now().toString(),
                    packageName: selectedPackage.name,
                    amount: `${selectedCurrency.symbol}${getLocalPrice(selectedPackage)}`,
                    currency: selectedCurrency.code,
                    date: Date.now(),
                    status: 'Completed'
                };
                
                transactions.push(newTransaction);
                setTransactions(transactions);
                
                // Send payment email
                await sendPaymentEmail(currentUser, selectedPackage, getLocalPrice(selectedPackage), transactionId, selectedCurrency);
                
                showSuccess = true;
                transactionId = '';
                setTimeout(() => {
                    showSuccess = false;
                    showPayment = false;
                    selectedPackage = null;
                    showBuyCredits = false;
                    render();
                }, 3000);
                render();
            } else {
                error = 'Invalid transaction ID. Please check and try again.';
                render();
            }
        }

        function handleChatClick(match) {
            selectedMatch = match;
            currentView = 'chat';
            // Initialize chat messages for this match
            chatMessages = [
                {
                    id: '1',
                    text: 'Hey! Nice to meet you',
                    sender: 'user',
                    timestamp: Date.now() - 300000
                },
                {
                    id: '2',
                    text: match.lastMessage,
                    sender: 'match',
                    timestamp: Date.now() - 60000
                }
            ];
            render();
        }

        function handleSendMessage() {
            if (!currentMessage.trim() || !hasCreditsOrUnlimited()) return;

            // Add message to chat
            chatMessages.push({
                id: Date.now().toString(),
                text: currentMessage.trim(),
                sender: 'user',
                timestamp: Date.now()
            });

            // Deduct credit if not unlimited
            if (!currentUser.hasUnlimitedMessages) {
                currentUser.credits = currentUser.credits - 1;
                setCurrentUser(currentUser);
                
                // Update users array
                const users = getUsers();
                const updatedUsers = users.map(u => u.id === currentUser.id ? currentUser : u);
                setUsers(updatedUsers);
            }

            currentMessage = '';
            render();

            // Simulate response after 2 seconds
            setTimeout(() => {
                chatMessages.push({
                    id: (Date.now() + 1).toString(),
                    text: 'Thanks for your message! 😊',
                    sender: 'match',
                    timestamp: Date.now()
                });
                render();
            }, 2000);
        }

        function handleLikeMatch(matchId) {
            if (!hasCreditsOrUnlimited()) {
                showBuyCredits = true;
                render();
                return;
            }

            // Find the match and toggle like
            const matchIndex = matches.findIndex(m => m.id === matchId);
            if (matchIndex !== -1) {
                matches[matchIndex].hasLiked = !matches[matchIndex].hasLiked;
            }
            
            // Deduct credit if not unlimited
            if (!currentUser.hasUnlimitedMessages) {
                currentUser.credits = currentUser.credits - 1;
                setCurrentUser(currentUser);
                
                // Update users array
                const users = getUsers();
                const updatedUsers = users.map(u => u.id === currentUser.id ? currentUser : u);
                setUsers(updatedUsers);
            }

            render();
        }

        function handleLogout() {
            currentUser = null;
            setCurrentUser(null);
            currentView = 'auth';
            showUserMenu = false;
            render();
        }

        function handleProfileSave() {
            const updatedUser = {
                ...currentUser,
                name: editFormData.name,
                age: parseInt(editFormData.age),
                height: editFormData.height,
                country: editFormData.country,
                profileImage: editFormData.profileImage || currentUser.profileImage,
            };
            
            currentUser = updatedUser;
            setCurrentUser(updatedUser);
            
            // Update users array
            const users = getUsers();
            const updatedUsers = users.map(u => u.id === updatedUser.id ? updatedUser : u);
            setUsers(updatedUsers);
            
            isEditing = false;
            showAlertModal('Profile updated successfully!', 'success');
            render();
        }

        function handleProfileCancel() {
            editFormData = {
                name: currentUser.name,
                age: currentUser.age.toString(),
                height: currentUser.height,
                country: currentUser.country,
                profileImage: currentUser.profileImage || '',
            };
            isEditing = false;
            render();
        }

        function showAlertModal(message, type = 'info') {
            alertMessage = message;
            alertType = type;
            showAlert = true;
            render();
            
            setTimeout(() => {
                showAlert = false;
                render();
            }, 3000);
        }

        function initializeApp() {
            if (!currentUser) return;

            // Filter matches based on user preferences
            const filteredMatches = FAKE_MATCHES.filter(match => match.sex === currentUser.lookingFor);
            
            // Sort matches: online first, then by last activity, then those with messages
            matches = filteredMatches.sort((a, b) => {
                if (a.isOnline && !b.isOnline) return -1;
                if (!a.isOnline && b.isOnline) return 1;
                if (a.unreadCount > 0 && b.unreadCount === 0) return -1;
                if (a.unreadCount === 0 && b.unreadCount > 0) return 1;
                return b.lastActivity - a.lastActivity;
            });

            // Initialize notifications
            notifications = getNotifications();
            transactions = getTransactions();

            // Only create notifications if there are matches available
            if (matches.length > 0) {
                const notificationIntervals = [120000, 180000, 240000, 300000]; // 2min, 3min, 4min, 5min
                
                notificationIntervals.forEach((interval, index) => {
                    setTimeout(() => {
                        const randomMatch = matches[Math.floor(Math.random() * matches.length)];
                        const notificationTypes = [
                            {
                                type: 'message',
                                title: 'New Message!',
                                message: `${randomMatch.name} sent you a message. Buy credits to unlock it.`,
                            },
                            {
                                type: 'like',
                                title: 'Someone likes you!',
                                message: `${randomMatch.name} liked your profile. Buy credits to see who.`,
                            }
                        ];
                        
                        const notification = notificationTypes[Math.floor(Math.random() * notificationTypes.length)];
                        
                        const newNotification = {
                            id: Date.now().toString() + index,
                            type: notification.type,
                            title: notification.title,
                            message: notification.message,
                            timestamp: Date.now(),
                            isRead: false,
                            data: { matchId: randomMatch.id },
                        };
                        
                        notifications.push(newNotification);
                        setNotifications(notifications);
                        render();
                    }, interval);
                });
            }

            // Shuffle matches every 5 minutes
            setInterval(() => {
                const onlineWithMessages = matches.filter(m => m.isOnline || m.unreadCount > 0);
                const others = matches.filter(m => !m.isOnline && m.unreadCount === 0);
                
                // Shuffle others array
                for (let i = others.length - 1; i > 0; i--) {
                    const j = Math.floor(Math.random() * (i + 1));
                    [others[i], others[j]] = [others[j], others[i]];
                }
                
                matches = [...onlineWithMessages, ...others];
                render();
            }, 300000); // 5 minutes
        }

        // Render functions
        function renderAuthScreen() {
            const creditsDisplay = currentUser?.hasUnlimitedMessages && 
                currentUser?.unlimitedUntil && 
                currentUser?.unlimitedUntil > Date.now() ? '∞' : currentUser?.credits || 0;

            return `
                <div class="min-h-screen gradient-bg flex items-center justify-center p-4">
                    <div class="bg-white rounded-2xl shadow-2xl w-full max-w-md overflow-hidden">
                        <div class="p-8">
                            <div class="text-center mb-8">
                                <div class="flex items-center justify-center mb-4">
                                    <svg class="text-pink-500 mr-2" width="32" height="32" viewBox="0 0 24 24" fill="currentColor">
                                        <path d="M20.84 4.61a5.5 5.5 0 0 0-7.78 0L12 5.67l-1.06-1.06a5.5 5.5 0 0 0-7.78 7.78l1.06 1.06L12 21.23l7.78-7.78 1.06-1.06a5.5 5.5 0 0 0 0-7.78z"/>
                                    </svg>
                                    <h1 class="text-3xl font-bold gradient-text">Zuri Love</h1>
                                </div>
                                <p class="text-gray-600">
                                    ${isLogin ? 'Welcome back!' : 'Find your perfect match'}
                                </p>
                            </div>

                            ${error ? `
                                <div class="bg-red-50 border border-red-200 rounded-lg p-3 mb-4">
                                    <p class="text-red-600 text-sm">${error}</p>
                                </div>
                            ` : ''}

                            <form onsubmit="handleLogin(event)" class="space-y-4">
                                <input
                                    type="email"
                                    placeholder="Email"
                                    value="${formData.email}"
                                    oninput="formData.email = this.value"
                                    class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-pink-500 focus:border-transparent transition-all duration-200"
                                    required
                                />

                                <div class="relative">
                                    <input
                                        type="${showPassword ? 'text' : 'password'}"
                                        placeholder="Password"
                                        value="${formData.password}"
                                        oninput="formData.password = this.value"
                                        class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-pink-500 focus:border-transparent transition-all duration-200"
                                        required
                                    />
                                    <button
                                        type="button"
                                        onclick="showPassword = !showPassword; render()"
                                        class="absolute right-3 top-3 text-gray-500 hover:text-gray-700"
                                    >
                                        ${showPassword ? 
                                            '<svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M17.94 17.94A10.07 10.07 0 0 1 12 20c-7 0-11-8-11-8a18.45 18.45 0 0 1 5.06-5.94M9.9 4.24A9.12 9.12 0 0 1 12 4c7 0 11 8 11 8a18.5 18.5 0 0 1-2.16 3.19m-6.72-1.07a3 3 0 1 1-4.24-4.24"/><line x1="1" y1="1" x2="23" y2="23"/></svg>' :
                                            '<svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"/><circle cx="12" cy="12" r="3"/></svg>'
                                        }
                                    </button>
                                </div>

                                ${!isLogin ? `
                                    <input
                                        type="text"
                                        placeholder="Full Name"
                                        value="${formData.name}"
                                        oninput="formData.name = this.value"
                                        class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-pink-500 focus:border-transparent transition-all duration-200"
                                        required
                                    />

                                    <div class="grid grid-cols-2 gap-4">
                                        <input
                                            type="number"
                                            placeholder="Age"
                                            value="${formData.age}"
                                            oninput="formData.age = this.value"
                                            class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-pink-500 focus:border-transparent transition-all duration-200"
                                            required
                                        />
                                        <input
                                            type="text"
                                            placeholder="Height"
                                            value="${formData.height}"
                                            oninput="formData.height = this.value"
                                            class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-pink-500 focus:border-transparent transition-all duration-200"
                                            required
                                        />
                                    </div>

                                    <div class="relative">
                                        <button
                                            type="button"
                                            onclick="showCountryDropdown = !showCountryDropdown; render()"
                                            class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-pink-500 focus:border-transparent transition-all duration-200 text-left flex items-center justify-between"
                                        >
                                            <span class="${formData.country ? 'text-gray-800' : 'text-gray-500'}">
                                                ${formData.country || 'Select Country'}
                                            </span>
                                            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                                <polyline points="6,9 12,15 18,9"/>
                                            </svg>
                                        </button>
                                        
                                        ${showCountryDropdown ? `
                                            <div class="absolute z-10 w-full mt-1 bg-white border border-gray-300 rounded-lg shadow-lg max-h-60 overflow-y-auto">
                                                ${COUNTRIES.map(country => `
                                                    <button
                                                        type="button"
                                                        onclick="handleCountrySelect('${country.name}')"
                                                        class="w-full px-4 py-2 text-left hover:bg-gray-100 flex items-center justify-between"
                                                    >
                                                        <span>${country.name}</span>
                                                        <span class="text-gray-500 text-sm">${country.dialCode}</span>
                                                    </button>
                                                `).join('')}
                                            </div>
                                        ` : ''}
                                    </div>

                                    <div class="flex gap-2">
                                        <div class="w-20">
                                            <input
                                                type="text"
                                                placeholder="+1"
                                                value="${formData.countryCode}"
                                                oninput="formData.countryCode = this.value"
                                                class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-pink-500 focus:border-transparent transition-all duration-200"
                                                required
                                            />
                                        </div>
                                        <div class="flex-1">
                                            <input
                                                type="tel"
                                                placeholder="Phone Number"
                                                value="${formData.phoneNumber}"
                                                oninput="formData.phoneNumber = this.value"
                                                class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-pink-500 focus:border-transparent transition-all duration-200"
                                                required
                                            />
                                        </div>
                                    </div>

                                    <select
                                        value="${formData.sex}"
                                        onchange="formData.sex = this.value"
                                        class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-pink-500 focus:border-transparent transition-all duration-200 appearance-none"
                                        required
                                    >
                                        <option value="">Select Your Sex</option>
                                        <option value="male">Male</option>
                                        <option value="female">Female</option>
                                    </select>

                                    <select
                                        value="${formData.lookingFor}"
                                        onchange="formData.lookingFor = this.value"
                                        class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-pink-500 focus:border-transparent transition-all duration-200 appearance-none"
                                        required
                                    >
                                        <option value="">Looking For</option>
                                        <option value="male">Men</option>
                                        <option value="female">Women</option>
                                    </select>

                                    <select
                                        value="${formData.relationshipStatus}"
                                        onchange="formData.relationshipStatus = this.value"
                                        class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-pink-500 focus:border-transparent transition-all duration-200 appearance-none"
                                        required
                                    >
                                        <option value="">Relationship Status</option>
                                        <option value="single">Single</option>
                                        <option value="divorced">Divorced</option>
                                        <option value="widowed">Widowed</option>
                                        <option value="separated">Separated</option>
                                    </select>

                                    <select
                                        value="${formData.relationshipType}"
                                        onchange="formData.relationshipType = this.value"
                                        class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-pink-500 focus:border-transparent transition-all duration-200 appearance-none"
                                        required
                                    >
                                        <option value="">Relationship Type</option>
                                        <option value="friendship">Friendship</option>
                                        <option value="short-term">Short-term Relationship</option>
                                        <option value="long-term">Long-term Relationship</option>
                                        <option value="marriage">Marriage</option>
                                    </select>

                                    <div class="border-2 border-dashed border-gray-300 rounded-lg p-4 text-center hover:border-pink-500 transition-colors">
                                        <input
                                            type="file"
                                            accept="image/*"
                                            onchange="handleImageUpload(event)"
                                            class="hidden"
                                            id="profile-image"
                                        />
                                        <label for="profile-image" class="cursor-pointer">
                                            ${profileImage ? `
                                                <img
                                                    src="${profileImage}"
                                                    alt="Profile"
                                                    class="w-20 h-20 rounded-full mx-auto mb-2 object-cover"
                                                />
                                            ` : `
                                                <svg class="w-8 h-8 text-gray-400 mx-auto mb-2" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                                    <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/>
                                                    <polyline points="7,10 12,15 17,10"/>
                                                    <line x1="12" y1="15" x2="12" y2="3"/>
                                                </svg>
                                            `}
                                            <p class="text-sm text-gray-600">
                                                ${profileImage ? 'Change photo' : 'Upload profile photo'}
                                            </p>
                                        </label>
                                    </div>
                                ` : ''}

                                <button type="submit" class="w-full gradient-button text-white font-medium py-3 px-6 rounded-lg hover:shadow-lg transition-all duration-200">
                                    ${isLogin ? 'Sign In' : 'Create Account'}
                                </button>
                            </form>

                            <div class="mt-6 text-center">
                                <p class="text-gray-600">
                                    ${isLogin ? "Don't have an account?" : "Already have an account?"}
                                    <button
                                        onclick="isLogin = !isLogin; error = ''; render()"
                                        class="text-pink-500 hover:text-pink-600 ml-1 font-medium"
                                    >
                                        ${isLogin ? 'Sign Up' : 'Sign In'}
                                    </button>
                                </p>
                            </div>
                        </div>
                    </div>
                </div>
            `;
        }

        function renderHeader() {
            const creditsDisplay = currentUser.hasUnlimitedMessages && 
                currentUser.unlimitedUntil && 
                currentUser.unlimitedUntil > Date.now() ? '∞' : currentUser.credits;

            const unreadNotifications = notifications.filter(n => !n.isRead).length;

            return `
                <div class="bg-white shadow-sm sticky top-0 z-40">
                    <div class="max-w-6xl mx-auto px-4 py-4">
                        <div class="flex items-center justify-between">
                            <div class="flex items-center">
                                <svg class="text-pink-500 mr-2" width="28" height="28" viewBox="0 0 24 24" fill="currentColor">
                                    <path d="M20.84 4.61a5.5 5.5 0 0 0-7.78 0L12 5.67l-1.06-1.06a5.5 5.5 0 0 0-7.78 7.78l1.06 1.06L12 21.23l7.78-7.78 1.06-1.06a5.5 5.5 0 0 0 0-7.78z"/>
                                </svg>
                                <h1 class="text-2xl font-bold gradient-text whitespace-nowrap">Zuri Love</h1>
                            </div>
                            
                            <div class="flex items-center gap-3">
                                <button
                                    onclick="showNotifications = !showNotifications; showUserMenu = false; render()"
                                    class="relative p-2 bg-blue-500 hover:bg-blue-600 text-white rounded-full transition-colors"
                                >
                                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                        <path d="M18 8A6 6 0 0 0 6 8c0 7-3 9-3 9h18s-3-2-3-9"/>
                                        <path d="M13.73 21a2 2 0 0 1-3.46 0"/>
                                    </svg>
                                    ${unreadNotifications > 0 ? `
                                        <span class="absolute -top-1 -right-1 bg-red-500 text-white text-xs rounded-full w-5 h-5 flex items-center justify-center notification-badge">
                                            ${unreadNotifications}
                                        </span>
                                    ` : ''}
                                </button>
                                
                                <div class="relative">
                                    <button
                                        onclick="showUserMenu = !showUserMenu; showNotifications = false; render()"
                                        class="p-2 bg-gray-500 hover:bg-gray-600 text-white rounded-full transition-colors relative"
                                    >
                                        ${currentUser.profileImage ? `
                                            <img
                                                src="${currentUser.profileImage}"
                                                alt="Profile"
                                                class="w-5 h-5 rounded-full object-cover"
                                            />
                                        ` : `
                                            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                                <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"/>
                                                <circle cx="12" cy="7" r="4"/>
                                            </svg>
                                        `}
                                    </button>

                                    ${showUserMenu ? `
                                        <div class="absolute top-12 right-0 bg-white rounded-lg shadow-xl border p-2 min-w-48 z-50">
                                            <div class="flex items-center gap-2 p-3 border-b">
                                                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" class="text-pink-500">
                                                    <rect x="2" y="3" width="20" height="14" rx="2" ry="2"/>
                                                    <line x1="8" y1="21" x2="16" y2="21"/>
                                                    <line x1="12" y1="17" x2="12" y2="21"/>
                                                </svg>
                                                <span class="font-semibold">
                                                    Credits: ${creditsDisplay === '∞' ? 'Unlimited' : creditsDisplay}
                                                </span>
                                            </div>
                                            
                                            <button
                                                onclick="showBuyCredits = true; showUserMenu = false; render()"
                                                class="w-full flex items-center gap-2 p-3 hover:bg-gray-100 rounded text-left"
                                            >
                                                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                                    <rect x="2" y="3" width="20" height="14" rx="2" ry="2"/>
                                                    <line x1="8" y1="21" x2="16" y2="21"/>
                                                    <line x1="12" y1="17" x2="12" y2="21"/>
                                                </svg>
                                                Buy Credits
                                            </button>
                                            
                                            <button
                                                onclick="showProfileSettings = true; showUserMenu = false; editFormData = { name: currentUser.name, age: currentUser.age.toString(), height: currentUser.height, country: currentUser.country, profileImage: currentUser.profileImage || '' }; render()"
                                                class="w-full flex items-center gap-2 p-3 hover:bg-gray-100 rounded text-left"
                                            >
                                                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                                    <circle cx="12" cy="12" r="3"/>
                                                    <path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1 1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z"/>
                                                </svg>
                                                Profile Settings
                                            </button>

                                            <button
                                                onclick="showTransactionHistory = true; showUserMenu = false; render()"
                                                class="w-full flex items-center gap-2 p-3 hover:bg-gray-100 rounded text-left"
                                            >
                                                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                                    <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/>
                                                    <polyline points="14,2 14,8 20,8"/>
                                                    <line x1="16" y1="13" x2="8" y2="13"/>
                                                    <line x1="16" y1="17" x2="8" y2="17"/>
                                                    <polyline points="10,9 9,9 8,9"/>
                                                </svg>
                                                Transaction History
                                            </button>

                                            <button
                                                onclick="showSupport = true; showUserMenu = false; render()"
                                                class="w-full flex items-center gap-2 p-3 hover:bg-gray-100 rounded text-left"
                                            >
                                                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                                    <circle cx="12" cy="12" r="10"/>
                                                    <path d="M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3"/>
                                                    <line x1="12" y1="17" x2="12.01" y2="17"/>
                                                </svg>
                                                Support
                                            </button>
                                            
                                            <div class="border-t pt-2">
                                                <button
                                                    onclick="handleLogout()"
                                                    class="w-full flex items-center gap-2 p-3 hover:bg-red-50 text-red-600 rounded text-left"
                                                >
                                                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                                        <path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"/>
                                                        <polyline points="16,17 21,12 16,7"/>
                                                        <line x1="21" y1="12" x2="9" y2="12"/>
                                                    </svg>
                                                    Logout
                                                </button>
                                            </div>
                                        </div>
                                    ` : ''}
                                </div>

                                ${showNotifications ? `
                                    <div class="absolute top-16 right-4 bg-white rounded-lg shadow-xl border p-4 min-w-80 max-w-sm z-50 max-h-96 overflow-y-auto">
                                        <h3 class="font-semibold text-gray-800 mb-3">Notifications</h3>
                                        ${notifications.length > 0 ? `
                                            <div class="space-y-3">
                                                ${notifications.slice().reverse().map(notification => `
                                                    <div class="p-3 border rounded-lg ${notification.isRead ? 'bg-gray-50' : 'bg-blue-50 border-blue-200'}">
                                                        <div class="flex items-start gap-3">
                                                            <div class="w-8 h-8 rounded-full flex items-center justify-center ${
                                                                notification.type === 'message' ? 'bg-blue-100' :
                                                                notification.type === 'like' ? 'bg-pink-100' : 'bg-green-100'
                                                            }">
                                                                ${notification.type === 'message' ? 
                                                                    '<svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" class="text-blue-500"><path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"/></svg>' :
                                                                    notification.type === 'like' ?
                                                                    '<svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor" class="text-pink-500"><path d="M20.84 4.61a5.5 5.5 0 0 0-7.78 0L12 5.67l-1.06-1.06a5.5 5.5 0 0 0-7.78 7.78l1.06 1.06L12 21.23l7.78-7.78 1.06-1.06a5.5 5.5 0 0 0 0-7.78z"/></svg>' :
                                                                    '<svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" class="text-green-500"><rect x="2" y="3" width="20" height="14" rx="2" ry="2"/><line x1="8" y1="21" x2="16" y2="21"/><line x1="12" y1="17" x2="12" y2="21"/></svg>'
                                                                }
                                                            </div>
                                                            <div class="flex-1">
                                                                <h4 class="font-medium text-gray-800 text-sm">${notification.title}</h4>
                                                                <p class="text-gray-600 text-xs mt-1">${notification.message}</p>
                                                                <p class="text-gray-400 text-xs mt-1">${formatTime(notification.timestamp)}</p>
                                                            </div>
                                                        </div>
                                                    </div>
                                                `).join('')}
                                            </div>
                                            <button
                                                onclick="notifications.forEach(n => n.isRead = true); setNotifications(notifications); render()"
                                                class="w-full mt-3 text-sm text-blue-600 hover:text-blue-700"
                                            >
                                                Mark all as read
                                            </button>
                                        ` : `
                                            <p class="text-gray-500 text-sm">No notifications yet</p>
                                        `}
                                    </div>
                                ` : ''}
                            </div>
                        </div>
                    </div>
                </div>
            `;
        }

        function renderMainScreen() {
            return `
                <div class="min-h-screen bg-gray-50">
                    ${renderHeader()}
                    
                    <div class="max-w-6xl mx-auto px-4 py-8">
                        <div class="mb-8">
                            <h2 class="text-3xl font-bold text-gray-800 mb-2">Your Matches</h2>
                            <p class="text-gray-600">
                                ${matches.length} people are waiting to meet you
                            </p>
                        </div>

                        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                            ${matches.map(match => `
                                <div class="bg-white rounded-xl shadow-lg overflow-hidden card-hover">
                                    <div class="relative">
                                        <img
                                            src="${match.profileImage}"
                                            alt="${match.name}"
                                            class="w-full h-48 object-cover"
                                        />
                                        ${match.isOnline ? `
                                            <div class="absolute top-3 right-3 w-3 h-3 bg-green-500 rounded-full border-2 border-white online-dot"></div>
                                        ` : ''}
                                        ${match.unreadCount > 0 ? `
                                            <div class="absolute top-3 left-3 bg-red-500 text-white text-xs rounded-full w-6 h-6 flex items-center justify-center notification-badge">
                                                ${match.unreadCount}
                                            </div>
                                        ` : ''}
                                        ${match.hasLiked ? `
                                            <div class="absolute bottom-3 right-3 bg-pink-500 text-white rounded-full p-2">
                                                <svg width="16" height="16" viewBox="0 0 24 24" fill="white">
                                                    <path d="M20.84 4.61a5.5 5.5 0 0 0-7.78 0L12 5.67l-1.06-1.06a5.5 5.5 0 0 0-7.78 7.78l1.06 1.06L12 21.23l7.78-7.78 1.06-1.06a5.5 5.5 0 0 0 0-7.78z"/>
                                                </svg>
                                            </div>
                                        ` : ''}
                                    </div>
                                    
                                    <div class="p-4">
                                        <h3 class="text-lg font-semibold text-gray-800 mb-1">${match.name}</h3>
                                        <p class="text-sm text-gray-600 mb-3 flex items-center gap-1">
                                            <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                                <path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"/>
                                                <circle cx="9" cy="7" r="4"/>
                                                <path d="M23 21v-2a4 4 0 0 0-3-3.87"/>
                                                <path d="M16 3.13a4 4 0 0 1 0 7.75"/>
                                            </svg>
                                            ${match.age} • ${match.country}
                                        </p>
                                        
                                        ${match.lastMessage ? `
                                            <div class="bg-gray-50 rounded-lg p-3 mb-3">
                                                <p class="text-sm text-gray-600 line-clamp-2">${match.lastMessage}</p>
                                            </div>
                                        ` : ''}
                                        
                                        <div class="flex gap-2">
                                            <button
                                                onclick="handleChatClick(${JSON.stringify(match).replace(/"/g, '&quot;')})"
                                                class="flex-1 gradient-button text-white px-4 py-2 rounded-lg text-sm font-medium hover:shadow-lg transition-all duration-200 flex items-center justify-center gap-2"
                                            >
                                                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                                    <path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"/>
                                                </svg>
                                                ${hasCreditsOrUnlimited() ? 'Chat' : 'Unlock Chat'}
                                            </button>
                                            <button
                                                onclick="handleLikeMatch('${match.id}')"
                                                class="p-2 ${match.hasLiked ? 'gradient-button text-white' : 'bg-gray-200 text-gray-800 hover:bg-gray-300'} rounded-lg transition-all duration-200"
                                            >
                                                <svg width="16" height="16" viewBox="0 0 24 24" fill="${match.hasLiked ? 'white' : 'none'}" stroke="currentColor" stroke-width="2">
                                                    <path d="M20.84 4.61a5.5 5.5 0 0 0-7.78 0L12 5.67l-1.06-1.06a5.5 5.5 0 0 0-7.78 7.78l1.06 1.06L12 21.23l7.78-7.78 1.06-1.06a5.5 5.5 0 0 0 0-7.78z"/>
                                                </svg>
                                            </button>
                                        </div>
                                    </div>
                                </div>
                            `).join('')}
                        </div>
                    </div>
                </div>
            `;
        }

        function renderChatScreen() {
            return `
                <div class="min-h-screen bg-gray-50 flex flex-col">
                    <!-- Header -->
                    <div class="bg-white shadow-sm border-b">
                        <div class="max-w-md mx-auto flex items-center p-4">
                            <button
                                onclick="currentView = 'main'; render()"
                                class="p-2 hover:bg-gray-100 rounded-full transition-colors mr-3"
                            >
                                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <line x1="19" y1="12" x2="5" y2="12"/>
                                    <polyline points="12,19 5,12 12,5"/>
                                </svg>
                            </button>
                            <div class="flex items-center flex-1">
                                <div class="relative">
                                    <img
                                        src="${selectedMatch.profileImage}"
                                        alt="${selectedMatch.name}"
                                        class="w-10 h-10 rounded-full object-cover"
                                    />
                                    ${selectedMatch.isOnline ? `
                                        <div class="absolute bottom-0 right-0 w-3 h-3 bg-green-500 rounded-full border-2 border-white"></div>
                                    ` : ''}
                                </div>
                                <div class="ml-3">
                                    <h2 class="font-semibold text-gray-800">${selectedMatch.name}</h2>
                                    <p class="text-sm text-gray-600">
                                        ${selectedMatch.isOnline ? 'Online' : 'Offline'}
                                    </p>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Messages -->
                    <div class="flex-1 max-w-md mx-auto w-full p-4">
                        ${!hasCreditsOrUnlimited() ? `
                            <div class="flex flex-col items-center justify-center h-full text-center">
                                <svg class="text-gray-400 mb-4" width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <rect x="3" y="11" width="18" height="11" rx="2" ry="2"/>
                                    <circle cx="12" cy="16" r="1"/>
                                    <path d="M7 11V7a5 5 0 0 1 10 0v4"/>
                                </svg>
                                <h3 class="text-lg font-semibold text-gray-800 mb-2">
                                    Messages are locked
                                </h3>
                                <p class="text-gray-600 mb-6">
                                    You need credits to send and view messages
                                </p>
                                <button onclick="showBuyCredits = true; render()" class="gradient-button text-white px-6 py-3 rounded-lg font-medium hover:shadow-lg transition-all duration-200 flex items-center gap-2">
                                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                        <rect x="3" y="11" width="18" height="11" rx="2" ry="2"/>
                                        <circle cx="12" cy="16" r="1"/>
                                        <path d="M7 11V7a5 5 0 0 1 10 0v4"/>
                                    </svg>
                                    Buy Credits
                                </button>
                            </div>
                        ` : `
                            <div class="space-y-4" id="chat-messages">
                                ${chatMessages.map(message => `
                                    <div class="flex ${message.sender === 'user' ? 'justify-end' : 'justify-start'}">
                                        <div class="${message.sender === 'user' ? 'gradient-button text-white' : 'bg-white border'} px-4 py-2 rounded-2xl max-w-xs">
                                            <p class="text-sm ${message.sender === 'user' ? 'text-white' : 'text-gray-800'}">${message.text}</p>
                                            <p class="text-xs ${message.sender === 'user' ? 'opacity-75' : 'text-gray-500'} mt-1">${formatTime(message.timestamp)}</p>
                                        </div>
                                    </div>
                                `).join('')}
                            </div>
                        `}
                    </div>

                    <!-- Message Input -->
                    ${hasCreditsOrUnlimited() ? `
                        <div class="bg-white border-t p-4 max-w-md mx-auto w-full">
                            <div class="flex items-center gap-3">
                                <input
                                    type="text"
                                    placeholder="Type a message..."
                                    value="${currentMessage}"
                                    oninput="currentMessage = this.value"
                                    onkeypress="if(event.key === 'Enter') handleSendMessage()"
                                    class="flex-1 px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-pink-500 focus:border-transparent transition-all duration-200"
                                />
                                <button onclick="handleSendMessage()" class="gradient-button text-white p-3 rounded-lg hover:shadow-lg transition-all duration-200">
                                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                        <line x1="22" y1="2" x2="11" y2="13"/>
                                        <polygon points="22,2 15,22 11,13 2,9 22,2"/>
                                    </svg>
                                </button>
                            </div>
                        </div>
                    ` : ''}
                </div>
            `;
        }

        function renderBuyCreditsModal() {
            if (!showBuyCredits) return '';

            return `
                <div class="fixed inset-0 modal-overlay flex items-center justify-center z-50 p-4">
                    <div class="bg-white rounded-xl shadow-xl w-full max-w-md max-h-[90vh] overflow-y-auto">
                        <div class="flex items-center justify-between p-6 border-b">
                            <h2 class="text-xl font-bold text-gray-800">Buy Credits</h2>
                            <button
                                onclick="showBuyCredits = false; showPayment = false; showSuccess = false; selectedPackage = null; error = ''; transactionId = ''; render()"
                                class="p-2 hover:bg-gray-100 rounded-full transition-colors"
                            >
                                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <line x1="18" y1="6" x2="6" y2="18"/>
                                    <line x1="6" y1="6" x2="18" y2="18"/>
                                </svg>
                            </button>
                        </div>
                        <div class="p-6">
                            ${showSuccess ? `
                                <div class="text-center py-8">
                                    <div class="w-16 h-16 bg-green-100 rounded-full flex items-center justify-center mx-auto mb-4">
                                        <svg class="text-green-600" width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                            <polyline points="20,6 9,17 4,12"/>
                                        </svg>
                                    </div>
                                    <h3 class="text-lg font-semibold text-gray-800 mb-2">
                                        Payment Successful!
                                    </h3>
                                    <p class="text-gray-600">
                                        ${selectedPackage?.isUnlimited 
                                            ? 'Unlimited messages activated for 1 month!' 
                                            : `${selectedPackage?.credits} credits have been added to your account`
                                        }
                                    </p>
                                </div>
                            ` : showPayment && selectedPackage ? `
                                <div class="space-y-6">
                                    <div class="text-center">
                                        <h3 class="text-lg font-semibold text-gray-800 mb-2">
                                            Complete Payment
                                        </h3>
                                        <div class="bg-gradient-to-r from-pink-50 to-purple-50 p-4 rounded-lg">
                                            <p class="font-semibold text-gray-800">${selectedPackage.name}</p>
                                            <p class="text-2xl font-bold text-pink-600">
                                                ${selectedCurrency.symbol}${getLocalPrice(selectedPackage)}
                                            </p>
                                        </div>
                                    </div>

                                    <div class="bg-blue-50 border border-blue-200 rounded-lg p-4">
                                        <h4 class="font-semibold text-blue-800 mb-2">Payment Instructions</h4>
                                        <p class="text-blue-700 text-sm mb-2">
                                            Send <strong>${selectedCurrency.symbol}${getLocalPrice(selectedPackage)}</strong> to M-Pesa Till Number:
                                        </p>
                                        <div class="bg-blue-100 p-3 rounded text-center">
                                            <p class="text-xl font-bold text-blue-800">12345678</p>
                                        </div>
                                    </div>

                                    ${error ? `
                                        <div class="bg-red-50 border border-red-200 rounded-lg p-3">
                                            <p class="text-red-600 text-sm">${error}</p>
                                        </div>
                                    ` : ''}

                                    <div class="space-y-4">
                                        <div>
                                            <label class="block text-sm font-medium text-gray-700 mb-1">Transaction ID</label>
                                            <input
                                                type="text"
                                                placeholder="Enter M-Pesa transaction ID"
                                                value="${transactionId}"
                                                oninput="transactionId = this.value"
                                                class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-pink-500 focus:border-transparent transition-all duration-200"
                                            />
                                            <p class="text-xs text-gray-500 mt-1">
                                                Enter the transaction ID you received from M-Pesa
                                            </p>
                                        </div>

                                        <div class="flex gap-3">
                                            <button onclick="handlePayment()" class="flex-1 gradient-button text-white px-6 py-3 rounded-lg font-medium hover:shadow-lg transition-all duration-200">
                                                Confirm Payment
                                            </button>
                                            <button onclick="showPayment = false; render()" class="bg-gray-200 text-gray-800 hover:bg-gray-300 px-6 py-3 rounded-lg font-medium transition-all duration-200">
                                                Back
                                            </button>
                                        </div>
                                    </div>
                                </div>
                            ` : `
                                <div class="space-y-6">
                                    <div class="text-center">
                                        <svg class="text-pink-500 mx-auto mb-4" width="64" height="64" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                            <rect x="2" y="3" width="20" height="14" rx="2" ry="2"/>
                                            <line x1="8" y1="21" x2="16" y2="21"/>
                                            <line x1="12" y1="17" x2="12" y2="21"/>
                                        </svg>
                                        <h3 class="text-lg font-semibold text-gray-800 mb-2">
                                            Choose Your Package
                                        </h3>
                                    </div>

                                    <div class="relative">
                                        <button
                                            type="button"
                                            onclick="showCurrencyDropdown = !showCurrencyDropdown; render()"
                                            class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-pink-500 focus:border-transparent transition-all duration-200 text-left flex items-center justify-between"
                                        >
                                            <span class="text-gray-800">
                                                ${selectedCurrency.symbol} ${selectedCurrency.name}
                                            </span>
                                            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                                <polyline points="6,9 12,15 18,9"/>
                                            </svg>
                                        </button>
                                        
                                        ${showCurrencyDropdown ? `
                                            <div class="absolute z-10 w-full mt-1 bg-white border border-gray-300 rounded-lg shadow-lg max-h-60 overflow-y-auto">
                                                ${CURRENCIES.map(currency => `
                                                    <button
                                                        type="button"
                                                        onclick="handleCurrencySelect('${currency.code}')"
                                                        class="w-full px-4 py-2 text-left hover:bg-gray-100 flex items-center justify-between"
                                                    >
                                                        <span>${currency.symbol} ${currency.name}</span>
                                                        <span class="text-gray-500 text-sm">${currency.code}</span>
                                                    </button>
                                                `).join('')}
                                            </div>
                                        ` : ''}
                                    </div>

                                    <div class="space-y-3">
                                        ${CREDIT_PACKAGES.map(pkg => `
                                            <div
                                                onclick="handlePackageSelect(${JSON.stringify(pkg).replace(/"/g, '&quot;')})"
                                                class="bg-gradient-to-r from-pink-50 to-purple-50 p-4 rounded-lg border hover:border-pink-300 transition-colors cursor-pointer"
                                            >
                                                <div class="flex items-center justify-between">
                                                    <div>
                                                        <p class="font-semibold text-gray-800">${pkg.name}</p>
                                                        <p class="text-sm text-gray-600">
                                                            ${pkg.isUnlimited 
                                                                ? `Unlimited messages for ${pkg.duration} days`
                                                                : `${pkg.credits} credits for messaging`
                                                            }
                                                        </p>
                                                    </div>
                                                    <div class="text-right">
                                                        <p class="font-bold text-lg text-pink-600">
                                                            ${selectedCurrency.symbol}${getLocalPrice(pkg)}
                                                        </p>
                                                        <p class="text-xs text-gray-500">
                                                            $${pkg.priceUSD} USD
                                                        </p>
                                                    </div>
                                                </div>
                                            </div>
                                        `).join('')}
                                    </div>

                                    <button onclick="showBuyCredits = false; render()" class="w-full bg-gray-200 text-gray-800 hover:bg-gray-300 px-6 py-3 rounded-lg font-medium transition-all duration-200">
                                        Cancel
                                    </button>
                                </div>
                            `}
                        </div>
                    </div>
                </div>
            `;
        }

        function renderProfileSettings() {
            if (!showProfileSettings) return '';

            return `
                <div class="fixed inset-0 modal-overlay flex items-center justify-center z-50 p-4">
                    <div class="bg-white rounded-xl shadow-xl w-full max-w-md max-h-[90vh] overflow-y-auto">
                        <div class="flex items-center justify-between p-6 border-b">
                            <h2 class="text-xl font-bold text-gray-800">Profile Settings</h2>
                            <button
                                onclick="showProfileSettings = false; isEditing = false; render()"
                                class="p-2 hover:bg-gray-100 rounded-full transition-colors"
                            >
                                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <line x1="18" y1="6" x2="6" y2="18"/>
                                    <line x1="6" y1="6" x2="18" y2="18"/>
                                </svg>
                            </button>
                        </div>
                        <div class="p-6">
                            <div class="text-center mb-6">
                                <div class="relative inline-block">
                                    ${editFormData.profileImage || currentUser.profileImage ? `
                                        <img
                                            src="${editFormData.profileImage || currentUser.profileImage}"
                                            alt="Profile"
                                            class="w-32 h-32 rounded-full border-4 border-white shadow-lg object-cover mx-auto"
                                        />
                                    ` : `
                                        <div class="w-32 h-32 rounded-full border-4 border-white shadow-lg bg-gray-200 flex items-center justify-center mx-auto">
                                            <svg width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" class="text-gray-400">
                                                <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"/>
                                                <circle cx="12" cy="7" r="4"/>
                                            </svg>
                                        </div>
                                    `}
                                    ${isEditing ? `
                                        <label
                                            for="profile-image-edit"
                                            class="absolute bottom-0 right-0 p-2 bg-pink-500 rounded-full text-white cursor-pointer hover:bg-pink-600 transition-colors"
                                        >
                                            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                                <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/>
                                                <polyline points="7,10 12,15 17,10"/>
                                                <line x1="12" y1="15" x2="12" y2="3"/>
                                            </svg>
                                            <input
                                                type="file"
                                                accept="image/*"
                                                onchange="handleImageUpload(event)"
                                                class="hidden"
                                                id="profile-image-edit"
                                            />
                                        </label>
                                    ` : ''}
                                </div>
                            </div>

                            ${isEditing ? `
                                <div class="space-y-4">
                                    <input
                                        type="text"
                                        placeholder="Full Name"
                                        value="${editFormData.name}"
                                        oninput="editFormData.name = this.value"
                                        class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-pink-500 focus:border-transparent transition-all duration-200"
                                    />
                                    <div class="grid grid-cols-2 gap-4">
                                        <input
                                            type="number"
                                            placeholder="Age"
                                            value="${editFormData.age}"
                                            oninput="editFormData.age = this.value"
                                            class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-pink-500 focus:border-transparent transition-all duration-200"
                                        />
                                        <input
                                            type="text"
                                            placeholder="Height"
                                            value="${editFormData.height}"
                                            oninput="editFormData.height = this.value"
                                            class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-pink-500 focus:border-transparent transition-all duration-200"
                                        />
                                    </div>
                                    <input
                                        type="text"
                                        placeholder="Country"
                                        value="${editFormData.country}"
                                        oninput="editFormData.country = this.value"
                                        class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-pink-500 focus:border-transparent transition-all duration-200"
                                    />
                                    <div class="flex gap-2">
                                        <button onclick="handleProfileSave()" class="flex-1 gradient-button text-white px-6 py-3 rounded-lg font-medium hover:shadow-lg transition-all duration-200 flex items-center justify-center gap-2">
                                            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                                <polyline points="20,6 9,17 4,12"/>
                                            </svg>
                                            Save
                                        </button>
                                        <button onclick="handleProfileCancel()" class="flex-1 bg-gray-200 text-gray-800 hover:bg-gray-300 px-6 py-3 rounded-lg font-medium transition-all duration-200 flex items-center justify-center gap-2">
                                            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                                <line x1="18" y1="6" x2="6" y2="18"/>
                                                <line x1="6" y1="6" x2="18" y2="18"/>
                                            </svg>
                                            Cancel
                                        </button>
                                    </div>
                                </div>
                            ` : `
                                <div class="space-y-4">
                                    <div class="text-center">
                                        <h3 class="text-xl font-bold text-gray-800 mb-4">${currentUser.name}</h3>
                                        <div class="space-y-2 text-gray-600">
                                            <p><span class="font-medium">Age:</span> ${currentUser.age}</p>
                                            <p><span class="font-medium">Height:</span> ${currentUser.height}</p>
                                            <p><span class="font-medium">Country:</span> ${currentUser.country}</p>
                                            <p><span class="font-medium">Email:</span> ${currentUser.email}</p>
                                        </div>
                                    </div>
                                    <button onclick="isEditing = true; render()" class="w-full gradient-button text-white px-6 py-3 rounded-lg font-medium hover:shadow-lg transition-all duration-200 flex items-center justify-center gap-2">
                                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                            <path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"/>
                                            <path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"/>
                                        </svg>
                                        Edit Profile
                                    </button>
                                </div>
                            `}
                        </div>
                    </div>
                </div>
            `;
        }

        function renderTransactionHistory() {
            if (!showTransactionHistory) return '';

            return `
                <div class="fixed inset-0 modal-overlay flex items-center justify-center z-50 p-4">
                    <div class="bg-white rounded-xl shadow-xl w-full max-w-md max-h-[90vh] overflow-y-auto">
                        <div class="flex items-center justify-between p-6 border-b">
                            <h2 class="text-xl font-bold text-gray-800">Transaction History</h2>
                            <button
                                onclick="showTransactionHistory = false; render()"
                                class="p-2 hover:bg-gray-100 rounded-full transition-colors"
                            >
                                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <line x1="18" y1="6" x2="6" y2="18"/>
                                    <line x1="6" y1="6" x2="18" y2="18"/>
                                </svg>
                            </button>
                        </div>
                        <div class="p-6">
                            ${transactions.length > 0 ? `
                                <div class="space-y-4">
                                    ${transactions.slice().reverse().map(transaction => `
                                        <div class="border rounded-lg p-4">
                                            <div class="flex items-center justify-between mb-2">
                                                <h4 class="font-semibold text-gray-800">${transaction.packageName}</h4>
                                                <span class="text-sm px-2 py-1 bg-green-100 text-green-800 rounded-full">${transaction.status}</span>
                                            </div>
                                            <div class="text-sm text-gray-600">
                                                <p>Amount: ${transaction.amount}</p>
                                                <p>Date: ${formatDate(transaction.date)}</p>
                                                <p>Currency: ${transaction.currency}</p>
                                            </div>
                                        </div>
                                    `).join('')}
                                </div>
                            ` : `
                                <div class="text-center py-8">
                                    <svg class="text-gray-400 mx-auto mb-4" width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                        <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/>
                                        <polyline points="14,2 14,8 20,8"/>
                                        <line x1="16" y1="13" x2="8" y2="13"/>
                                        <line x1="16" y1="17" x2="8" y2="17"/>
                                        <polyline points="10,9 9,9 8,9"/>
                                    </svg>
                                    <h3 class="text-lg font-semibold text-gray-800 mb-2">No Transactions</h3>
                                    <p class="text-gray-600">You haven't made any purchases yet</p>
                                </div>
                            `}
                        </div>
                    </div>
                </div>
            `;
        }

        function renderSupport() {
            if (!showSupport) return '';

            return `
                <div class="fixed inset-0 modal-overlay flex items-center justify-center z-50 p-4">
                    <div class="bg-white rounded-xl shadow-xl w-full max-w-md max-h-[90vh] overflow-y-auto">
                        <div class="flex items-center justify-between p-6 border-b">
                            <h2 class="text-xl font-bold text-gray-800">Support</h2>
                            <button
                                onclick="showSupport = false; render()"
                                class="p-2 hover:bg-gray-100 rounded-full transition-colors"
                            >
                                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <line x1="18" y1="6" x2="6" y2="18"/>
                                    <line x1="6" y1="6" x2="18" y2="18"/>
                                </svg>
                            </button>
                        </div>
                        <div class="p-6">
                            <div class="space-y-6">
                                <div class="text-center">
                                    <svg class="text-blue-500 mx-auto mb-4" width="64" height="64" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                        <circle cx="12" cy="12" r="10"/>
                                        <path d="M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3"/>
                                        <line x1="12" y1="17" x2="12.01" y2="17"/>
                                    </svg>
                                    <h3 class="text-lg font-semibold text-gray-800 mb-2">Need Help?</h3>
                                    <p class="text-gray-600">We're here to help you with any questions or issues</p>
                                </div>

                                <div class="space-y-4">
                                    <div class="border rounded-lg p-4">
                                        <h4 class="font-semibold text-gray-800 mb-2">Frequently Asked Questions</h4>
                                        <div class="space-y-2 text-sm text-gray-600">
                                            <p><strong>Q:</strong> How do I buy credits?</p>
                                            <p><strong>A:</strong> Click on "Buy Credits" and follow the payment instructions.</p>
                                            
                                            <p><strong>Q:</strong> How do unlimited messages work?</p>
                                            <p><strong>A:</strong> With unlimited messages, you can chat without spending credits for the duration of your subscription.</p>
                                            
                                            <p><strong>Q:</strong> How do I update my profile?</p>
                                            <p><strong>A:</strong> Go to Profile Settings and click "Edit Profile".</p>
                                        </div>
                                    </div>

                                    <div class="border rounded-lg p-4">
                                        <h4 class="font-semibold text-gray-800 mb-2">Contact Support</h4>
                                        <p class="text-sm text-gray-600 mb-3">
                                            For additional help, contact our support team:
                                        </p>
                                        <div class="space-y-2 text-sm">
                                            <p><strong>Email:</strong> support@zurilove.com</p>
                                            <p><strong>Phone:</strong> +1 (555) 123-4567</p>
                                            <p><strong>Hours:</strong> 24/7 Support</p>
                                        </div>
                                    </div>

                                    <div class="border rounded-lg p-4">
                                        <h4 class="font-semibold text-gray-800 mb-2">App Version</h4>
                                        <p class="text-sm text-gray-600">Zuri Love v1.0.0</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            `;
        }

        function renderAlertModal() {
            if (!showAlert) return '';

            const alertColors = {
                success: 'bg-green-50 border-green-200 text-green-800',
                error: 'bg-red-50 border-red-200 text-red-800',
                info: 'bg-blue-50 border-blue-200 text-blue-800'
            };

            const alertIcons = {
                success: '<svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="20,6 9,17 4,12"/></svg>',
                error: '<svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="10"/><line x1="15" y1="9" x2="9" y2="15"/><line x1="9" y1="9" x2="15" y2="15"/></svg>',
                info: '<svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="10"/><line x1="12" y1="16" x2="12" y2="12"/><line x1="12" y1="8" x2="12.01" y2="8"/></svg>'
            };

            return `
                <div class="fixed inset-0 modal-overlay flex items-center justify-center z-50 p-4">
                    <div class="bg-white rounded-xl shadow-xl max-w-sm w-full">
                        <div class="p-6">
                            <div class="flex items-center gap-3">
                                <div class="${alertColors[alertType]} p-2 rounded-full">
                                    ${alertIcons[alertType]}
                                </div>
                                <div class="flex-1">
                                    <p class="text-gray-800 font-medium">${alertMessage}</p>
                                </div>
                                <button
                                    onclick="showAlert = false; render()"
                                    class="p-1 hover:bg-gray-100 rounded-full transition-colors"
                                >
                                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                        <line x1="18" y1="6" x2="6" y2="18"/>
                                        <line x1="6" y1="6" x2="18" y2="18"/>
                                    </svg>
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            `;
        }

        // Main render function
        function render() {
            const app = document.getElementById('app');
            
            let content = '';
            
            if (!currentUser || currentView === 'auth') {
                content = renderAuthScreen();
            } else if (currentView === 'main') {
                content = renderMainScreen();
            } else if (currentView === 'chat') {
                content = renderChatScreen();
            }
            
            // Add modals
            content += renderBuyCreditsModal();
            content += renderProfileSettings();
            content += renderTransactionHistory();
            content += renderSupport();
            content += renderAlertModal();
            
            app.innerHTML = content;

            // Close dropdowns when clicking outside
            document.addEventListener('click', function(event) {
                if (!event.target.closest('.relative')) {
                    showCountryDropdown = false;
                    showCurrencyDropdown = false;
                    showUserMenu = false;
                    showNotifications = false;
                    render();
                }
            });

            // Auto-scroll chat to bottom
            if (currentView === 'chat') {
                setTimeout(() => {
                    const chatMessages = document.getElementById('chat-messages');
                    if (chatMessages) {
                        chatMessages.scrollTop = chatMessages.scrollHeight;
                    }
                }, 100);
            }
        }

        // Initialize app
        function init() {
            currentUser = getCurrentUser();
            if (currentUser) {
                currentView = 'main';
                initializeApp();
            }
            render();
        }

        // Start the app
        init();
    </script>
</body>
</html>
