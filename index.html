<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Zuri Love - Dating App</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest/dist/umd/lucide.js"></script>
    <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/@emailjs/browser@4/dist/email.min.js"></script>
    <style>
        /* Hide scrollbars but keep scrolling functionality */
        * {
            scrollbar-width: none; /* Firefox */
            -ms-overflow-style: none; /* Internet Explorer 10+ */
        }
        *::-webkit-scrollbar {
            display: none; /* WebKit */
        }
        
        /* Force mobile layout on all devices */
        @media (min-width: 768px) {
            .max-w-6xl {
                max-width: 28rem !important; /* Force mobile width */
            }
            .md\:grid-cols-2 {
                grid-template-columns: repeat(1, minmax(0, 1fr)) !important;
            }
            .lg\:grid-cols-3 {
                grid-template-columns: repeat(1, minmax(0, 1fr)) !important;
            }
            .md\:flex {
                display: none !important;
            }
            .md\:hidden {
                display: flex !important;
            }
        }
        
        .gradient-bg {
            background: linear-gradient(135deg, #fce7f3 0%, #f3e8ff 50%, #e0e7ff 100%);
        }
        
        .gradient-text {
            background: linear-gradient(135deg, #ec4899, #8b5cf6);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }
        
        .line-clamp-2 {
            overflow: hidden;
            display: -webkit-box;
            -webkit-box-orient: vertical;
            -webkit-line-clamp: 2;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }

        .animate-pulse {
            animation: pulse 2s cubic-bezier(0.4, 0, 0.6, 1) infinite;
        }

        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.5);
        }

        .modal.show {
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .dropdown {
            display: none;
            position: absolute;
            background: white;
            border: 1px solid #e5e7eb;
            border-radius: 0.5rem;
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1);
            z-index: 1000;
        }

        .dropdown.show {
            display: block;
        }

        /* Ensure all inputs are properly styled and functional */
        input[type="text"], 
        input[type="email"], 
        input[type="password"], 
        input[type="number"], 
        input[type="tel"], 
        select, 
        textarea {
            width: 100%;
            padding: 0.75rem 1rem;
            border: 1px solid #d1d5db;
            border-radius: 0.5rem;
            font-size: 1rem;
            transition: all 0.2s;
            background-color: white;
            color: #374151;
        }

        input:focus, 
        select:focus, 
        textarea:focus {
            outline: none;
            border-color: #ec4899;
            box-shadow: 0 0 0 3px rgba(236, 72, 153, 0.1);
        }

        input::placeholder,
        textarea::placeholder {
            color: #9ca3af;
        }

        /* Fix for mobile inputs */
        @media (max-width: 768px) {
            input, select, textarea {
                font-size: 16px; /* Prevents zoom on iOS */
            }
        }
    </style>
</head>
<body class="bg-gray-50">
    <!-- Auth Screen -->
    <div id="authScreen" class="min-h-screen gradient-bg flex items-center justify-center p-4">
        <div class="bg-white rounded-2xl shadow-2xl w-full max-w-md overflow-hidden">
            <div class="p-8">
                <div class="text-center mb-8">
                    <div class="flex items-center justify-center mb-4">
                        <i data-lucide="heart" class="text-pink-500 mr-2 w-8 h-8"></i>
                        <h1 class="text-3xl font-bold gradient-text">Zuri Love</h1>
                    </div>
                    <p class="text-gray-600" id="authSubtitle">Welcome back!</p>
                </div>

                <div id="errorMessage" class="hidden bg-red-50 border border-red-200 rounded-lg p-3 mb-4">
                    <p class="text-red-600 text-sm" id="errorText"></p>
                </div>

                <form id="authForm" class="space-y-4">
                    <div>
                        <input 
                            type="email" 
                            id="email" 
                            name="email"
                            placeholder="Email" 
                            required 
                            autocomplete="email"
                            class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-pink-500 focus:border-transparent"
                        >
                    </div>

                    <div class="relative">
                        <input 
                            type="password" 
                            id="password" 
                            name="password"
                            placeholder="Password" 
                            required 
                            autocomplete="current-password"
                            class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-pink-500 focus:border-transparent pr-12"
                        >
                        <button type="button" id="togglePassword" class="absolute right-3 top-3 text-gray-500 hover:text-gray-700">
                            <i data-lucide="eye" class="w-5 h-5"></i>
                        </button>
                    </div>

                    <!-- Registration fields (hidden by default) -->
                    <div id="registrationFields" class="hidden space-y-4">
                        <div>
                            <input 
                                type="text" 
                                id="fullName" 
                                name="fullName"
                                placeholder="Full Name" 
                                autocomplete="name"
                                class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-pink-500 focus:border-transparent"
                            >
                        </div>

                        <div class="grid grid-cols-2 gap-4">
                            <input 
                                type="number" 
                                id="age" 
                                name="age"
                                placeholder="Age" 
                                min="18" 
                                max="100"
                                class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-pink-500 focus:border-transparent"
                            >
                            <input 
                                type="text" 
                                id="height" 
                                name="height"
                                placeholder="Height" 
                                class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-pink-500 focus:border-transparent"
                            >
                        </div>

                        <div>
                            <select 
                                id="country" 
                                name="country"
                                class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-pink-500 focus:border-transparent"
                            >
                                <option value="">Select Country</option>
                                <option value="United States">United States</option>
                                <option value="Canada">Canada</option>
                                <option value="United Kingdom">United Kingdom</option>
                                <option value="Australia">Australia</option>
                                <option value="Germany">Germany</option>
                                <option value="France">France</option>
                                <option value="Spain">Spain</option>
                                <option value="Italy">Italy</option>
                                <option value="Brazil">Brazil</option>
                                <option value="Mexico">Mexico</option>
                                <option value="India">India</option>
                                <option value="Japan">Japan</option>
                                <option value="South Korea">South Korea</option>
                                <option value="China">China</option>
                                <option value="Nigeria">Nigeria</option>
                                <option value="Kenya">Kenya</option>
                                <option value="South Africa">South Africa</option>
                                <option value="Egypt">Egypt</option>
                            </select>
                        </div>

                        <div class="flex gap-2">
                            <div class="w-20">
                                <input 
                                    type="text" 
                                    id="countryCode" 
                                    name="countryCode"
                                    placeholder="+1" 
                                    class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-pink-500 focus:border-transparent"
                                >
                            </div>
                            <div class="flex-1">
                                <input 
                                    type="tel" 
                                    id="phoneNumber" 
                                    name="phoneNumber"
                                    placeholder="Phone Number" 
                                    autocomplete="tel"
                                    class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-pink-500 focus:border-transparent"
                                >
                            </div>
                        </div>

                        <div>
                            <select 
                                id="sex" 
                                name="sex"
                                class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-pink-500 focus:border-transparent"
                            >
                                <option value="">Select Your Sex</option>
                                <option value="male">Male</option>
                                <option value="female">Female</option>
                            </select>
                        </div>

                        <div>
                            <select 
                                id="lookingFor" 
                                name="lookingFor"
                                class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-pink-500 focus:border-transparent"
                            >
                                <option value="">Looking For</option>
                                <option value="male">Men</option>
                                <option value="female">Women</option>
                            </select>
                        </div>

                        <div>
                            <select 
                                id="relationshipStatus" 
                                name="relationshipStatus"
                                class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-pink-500 focus:border-transparent"
                            >
                                <option value="">Relationship Status</option>
                                <option value="single">Single</option>
                                <option value="divorced">Divorced</option>
                                <option value="widowed">Widowed</option>
                                <option value="separated">Separated</option>
                            </select>
                        </div>

                        <div>
                            <select 
                                id="relationshipType" 
                                name="relationshipType"
                                class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-pink-500 focus:border-transparent"
                            >
                                <option value="">Relationship Type</option>
                                <option value="friendship">Friendship</option>
                                <option value="short-term">Short-term Relationship</option>
                                <option value="long-term">Long-term Relationship</option>
                                <option value="marriage">Marriage</option>
                            </select>
                        </div>

                        <div class="border-2 border-dashed border-gray-300 rounded-lg p-4 text-center hover:border-pink-500 transition-colors">
                            <input type="file" accept="image/*" id="profileImage" class="hidden">
                            <label for="profileImage" class="cursor-pointer">
                                <div id="imagePreview" class="hidden">
                                    <img id="previewImg" class="w-20 h-20 rounded-full mx-auto mb-2 object-cover">
                                </div>
                                <div id="uploadPlaceholder">
                                    <i data-lucide="upload" class="w-8 h-8 text-gray-400 mx-auto mb-2"></i>
                                    <p class="text-sm text-gray-600">Upload profile photo</p>
                                </div>
                            </label>
                        </div>
                    </div>

                    <button type="submit" class="w-full bg-gradient-to-r from-pink-500 to-purple-600 text-white py-3 rounded-lg font-medium hover:from-pink-600 hover:to-purple-700 transition-all">
                        <span id="submitText">Sign In</span>
                    </button>
                </form>

                <div class="mt-6 text-center">
                    <p class="text-gray-600">
                        <span id="switchText">Don't have an account?</span>
                        <button id="switchMode" class="text-pink-500 hover:text-pink-600 ml-1 font-medium">
                            <span id="switchButton">Sign Up</span>
                        </button>
                    </p>
                </div>
            </div>
        </div>
    </div>

    <!-- Main App Screen -->
    <div id="mainScreen" class="hidden min-h-screen bg-gray-50">
        <!-- Header -->
        <div class="bg-white shadow-sm sticky top-0 z-40">
            <div class="max-w-6xl mx-auto px-4 py-4">
                <div class="flex items-center justify-between">
                    <div class="flex items-center">
                        <i data-lucide="heart" class="text-pink-500 mr-2 w-7 h-7"></i>
                        <h1 class="text-2xl font-bold gradient-text">Zuri Love</h1>
                    </div>
                    
                    <div class="flex items-center gap-4">
                        <!-- Desktop view -->
                        <div class="hidden md:flex items-center gap-4">
                            <div class="flex items-center gap-2 bg-gradient-to-r from-pink-500 to-purple-600 text-white px-4 py-2 rounded-full">
                                <i data-lucide="credit-card" class="w-4 h-4"></i>
                                <span class="font-semibold" id="creditsDisplay">0</span>
                            </div>
                            
                            <button id="buyCreditsBtn" class="flex items-center gap-2 bg-gray-200 text-gray-800 hover:bg-gray-300 px-4 py-2 rounded-lg transition-colors">
                                <i data-lucide="credit-card" class="w-4 h-4"></i>
                                Buy Credits
                            </button>
                            
                            <button id="notificationsBtn" class="relative p-2 bg-blue-500 hover:bg-blue-600 text-white rounded-full transition-colors">
                                <i data-lucide="bell" class="w-5 h-5"></i>
                                <span id="notificationBadge" class="hidden absolute -top-1 -right-1 bg-red-500 text-white text-xs rounded-full w-5 h-5 flex items-center justify-center animate-pulse">0</span>
                            </button>
                            
                            <button id="profileBtn" class="p-2 bg-gray-500 hover:bg-gray-600 text-white rounded-full transition-colors">
                                <i data-lucide="user" class="w-5 h-5"></i>
                            </button>
                            
                            <button id="logoutBtn" class="p-2 bg-red-500 hover:bg-red-600 text-white rounded-full transition-colors">
                                <i data-lucide="log-out" class="w-5 h-5"></i>
                            </button>
                        </div>

                        <!-- Mobile view -->
                        <div class="md:hidden flex items-center gap-3">
                            <button id="notificationsBtnMobile" class="relative p-2 bg-blue-500 hover:bg-blue-600 text-white rounded-full transition-colors">
                                <i data-lucide="bell" class="w-5 h-5"></i>
                                <span id="notificationBadgeMobile" class="hidden absolute -top-1 -right-1 bg-red-500 text-white text-xs rounded-full w-5 h-5 flex items-center justify-center animate-pulse">0</span>
                            </button>
                            
                            <div class="relative">
                                <button id="mobileMenuBtn" class="p-2 bg-gray-500 hover:bg-gray-600 text-white rounded-full transition-colors">
                                    <i data-lucide="user" class="w-5 h-5"></i>
                                </button>

                                <!-- Mobile User Menu -->
                                <div id="mobileMenu" class="dropdown absolute top-12 right-0 bg-white rounded-lg shadow-xl border p-2 min-w-48 z-50">
                                    <div class="flex items-center gap-2 p-3 border-b">
                                        <i data-lucide="credit-card" class="w-4 h-4 text-pink-500"></i>
                                        <span class="font-semibold">Credits: <span id="creditsMobile">0</span></span>
                                    </div>
                                    
                                    <button id="buyCreditsMenuBtn" class="w-full flex items-center gap-2 p-3 hover:bg-gray-100 rounded">
                                        <i data-lucide="credit-card" class="w-4 h-4"></i>
                                        Buy Credits
                                    </button>
                                    
                                    <button id="profileMenuBtn" class="w-full flex items-center gap-2 p-3 hover:bg-gray-100 rounded">
                                        <i data-lucide="settings" class="w-4 h-4"></i>
                                        Profile Settings
                                    </button>
                                    
                                    <button id="transactionMenuBtn" class="w-full flex items-center gap-2 p-3 hover:bg-gray-100 rounded">
                                        <i data-lucide="history" class="w-4 h-4"></i>
                                        Transaction History
                                    </button>
                                    
                                    <button id="supportMenuBtn" class="w-full flex items-center gap-2 p-3 hover:bg-gray-100 rounded">
                                        <i data-lucide="help-circle" class="w-4 h-4"></i>
                                        Support
                                    </button>
                                    
                                    <div class="border-t pt-2">
                                        <button id="logoutMenuBtn" class="w-full flex items-center gap-2 p-3 hover:bg-red-50 text-red-600 rounded">
                                            <i data-lucide="log-out" class="w-4 h-4"></i>
                                            Logout
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Matches Grid -->
        <div class="max-w-6xl mx-auto px-4 py-8">
            <div class="mb-8">
                <h2 class="text-3xl font-bold text-gray-800 mb-2">Your Matches</h2>
                <p class="text-gray-600" id="matchesCount">Loading matches...</p>
            </div>

            <div id="matchesGrid" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                <!-- Matches will be populated here -->
            </div>
        </div>
    </div>

    <!-- Chat Screen -->
    <div id="chatScreen" class="hidden min-h-screen bg-gray-50 flex flex-col">
        <!-- Chat Header -->
        <div class="bg-white shadow-sm border-b">
            <div class="max-w-md mx-auto flex items-center p-4">
                <button id="backToMatches" class="p-2 hover:bg-gray-100 rounded-full transition-colors mr-3">
                    <i data-lucide="arrow-left" class="w-5 h-5"></i>
                </button>
                <div class="flex items-center flex-1">
                    <div class="relative">
                        <img id="chatUserImage" class="w-10 h-10 rounded-full object-cover" src="">
                        <div id="chatUserOnline" class="hidden absolute bottom-0 right-0 w-3 h-3 bg-green-500 rounded-full border-2 border-white"></div>
                    </div>
                    <div class="ml-3">
                        <h2 id="chatUserName" class="font-semibold text-gray-800"></h2>
                        <p id="chatUserStatus" class="text-sm text-gray-600">Offline</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Messages -->
        <div class="flex-1 max-w-md mx-auto w-full p-4">
            <div id="chatMessages" class="space-y-4">
                <!-- Messages will be populated here -->
            </div>
            
            <div id="chatLocked" class="hidden flex flex-col items-center justify-center h-full text-center">
                <i data-lucide="lock" class="text-gray-400 mb-4 w-12 h-12"></i>
                <h3 class="text-lg font-semibold text-gray-800 mb-2">Messages are locked</h3>
                <p class="text-gray-600 mb-6">You need credits to send and view messages</p>
                <button id="unlockChatBtn" class="flex items-center gap-2 bg-gradient-to-r from-pink-500 to-purple-600 text-white px-6 py-3 rounded-lg font-medium hover:from-pink-600 hover:to-purple-700 transition-all">
                    <i data-lucide="lock" class="w-4 h-4"></i>
                    Buy Credits
                </button>
            </div>
        </div>

        <!-- Message Input -->
        <div id="chatInput" class="hidden bg-white border-t p-4 max-w-md mx-auto w-full">
            <div class="flex items-center gap-3">
                <textarea 
                    id="messageInput" 
                    placeholder="Type a message..." 
                    rows="1"
                    class="flex-1 px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-pink-500 focus:border-transparent resize-none"
                ></textarea>
                <button id="sendMessageBtn" class="bg-gradient-to-r from-pink-500 to-purple-600 text-white p-3 rounded-lg hover:from-pink-600 hover:to-purple-700 transition-all">
                    <i data-lucide="send" class="w-5 h-5"></i>
                </button>
            </div>
        </div>
    </div>

    <!-- Buy Credits Modal -->
    <div id="buyCreditsModal" class="modal">
        <div class="bg-white rounded-xl shadow-xl w-full max-w-md max-h-[90vh] overflow-y-auto m-4">
            <div class="flex items-center justify-between p-6 border-b">
                <h2 class="text-xl font-bold text-gray-800">Buy Credits</h2>
                <button id="closeBuyCredits" class="p-2 hover:bg-gray-100 rounded-full transition-colors">
                    <i data-lucide="x" class="w-5 h-5"></i>
                </button>
            </div>
            <div class="p-6">
                <div id="buyCreditsContent">
                    <div class="text-center mb-6">
                        <i data-lucide="credit-card" class="text-pink-500 mx-auto mb-4 w-16 h-16"></i>
                        <h3 class="text-lg font-semibold text-gray-800 mb-2">Choose Your Package</h3>
                    </div>

                    <div class="mb-6">
                        <label class="block text-sm font-medium text-gray-700 mb-2">Select Currency</label>
                        <select id="currencySelect" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-pink-500 focus:border-transparent">
                            <option value="USD">$ US Dollar</option>
                            <option value="EUR">€ Euro</option>
                            <option value="GBP">£ British Pound</option>
                            <option value="KES">KSh Kenyan Shilling</option>
                            <option value="NGN">₦ Nigerian Naira</option>
                        </select>
                    </div>

                    <div class="space-y-3 mb-6">
                        <div class="bg-gradient-to-r from-pink-50 to-purple-50 p-4 rounded-lg border hover:border-pink-300 transition-colors cursor-pointer" data-package="1">
                            <div class="flex items-center justify-between">
                                <div>
                                    <p class="font-semibold text-gray-800">10 Credits</p>
                                    <p class="text-sm text-gray-600">10 credits for messaging</p>
                                </div>
                                <div class="text-right">
                                    <p class="font-bold text-lg text-pink-600" data-price="1">$1.00</p>
                                    <p class="text-xs text-gray-500">$1.00 USD</p>
                                </div>
                            </div>
                        </div>

                        <div class="bg-gradient-to-r from-pink-50 to-purple-50 p-4 rounded-lg border hover:border-pink-300 transition-colors cursor-pointer" data-package="2">
                            <div class="flex items-center justify-between">
                                <div>
                                    <p class="font-semibold text-gray-800">Unlimited Messages (1 Month)</p>
                                    <p class="text-sm text-gray-600">Unlimited messages for 30 days</p>
                                </div>
                                <div class="text-right">
                                    <p class="font-bold text-lg text-pink-600" data-price="5">$5.00</p>
                                    <p class="text-xs text-gray-500">$5.00 USD</p>
                                </div>
                            </div>
                        </div>

                        <div class="bg-gradient-to-r from-pink-50 to-purple-50 p-4 rounded-lg border hover:border-pink-300 transition-colors cursor-pointer" data-package="3">
                            <div class="flex items-center justify-between">
                                <div>
                                    <p class="font-semibold text-gray-800">Unlimited Messages (1 Month Premium)</p>
                                    <p class="text-sm text-gray-600">Unlimited messages for 30 days</p>
                                </div>
                                <div class="text-right">
                                    <p class="font-bold text-lg text-pink-600" data-price="10">$10.00</p>
                                    <p class="text-xs text-gray-500">$10.00 USD</p>
                                </div>
                            </div>
                        </div>
                    </div>

                    <button id="cancelBuyCredits" class="w-full bg-gray-200 text-gray-800 hover:bg-gray-300 py-3 rounded-lg font-medium transition-colors">
                        Cancel
                    </button>
                </div>

                <!-- Payment Form -->
                <div id="paymentForm" class="hidden">
                    <div class="text-center mb-6">
                        <h3 class="text-lg font-semibold text-gray-800 mb-2">Complete Payment</h3>
                        <div class="bg-gradient-to-r from-pink-50 to-purple-50 p-4 rounded-lg">
                            <p class="font-semibold text-gray-800" id="selectedPackageName"></p>
                            <p class="text-2xl font-bold text-pink-600" id="selectedPackagePrice"></p>
                        </div>
                    </div>

                    <div class="bg-blue-50 border border-blue-200 rounded-lg p-4 mb-6">
                        <h4 class="font-semibold text-blue-800 mb-2">Payment Instructions</h4>
                        <p class="text-blue-700 text-sm mb-2">
                            Send <strong id="paymentAmount"></strong> to M-Pesa Till Number:
                        </p>
                        <div class="bg-blue-100 p-3 rounded text-center">
                            <p class="text-xl font-bold text-blue-800">12345678</p>
                        </div>
                    </div>

                    <div id="paymentError" class="hidden bg-red-50 border border-red-200 rounded-lg p-3 mb-4">
                        <p class="text-red-600 text-sm" id="paymentErrorText"></p>
                    </div>

                    <div class="space-y-4 mb-6">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Transaction ID</label>
                            <input 
                                type="text" 
                                id="transactionId" 
                                name="transactionId"
                                placeholder="Enter M-Pesa transaction ID" 
                                class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-pink-500 focus:border-transparent"
                            >
                            <p class="text-xs text-gray-500 mt-1">Enter the transaction ID you received from M-Pesa</p>
                        </div>

                        <div class="flex gap-3">
                            <button id="confirmPayment" class="flex-1 bg-gradient-to-r from-pink-500 to-purple-600 text-white py-3 rounded-lg font-medium hover:from-pink-600 hover:to-purple-700 transition-all">
                                Confirm Payment
                            </button>
                            <button id="backToPackages" class="bg-gray-200 text-gray-800 hover:bg-gray-300 px-6 py-3 rounded-lg font-medium transition-colors">
                                Back
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Success Message -->
                <div id="paymentSuccess" class="hidden text-center py-8">
                    <div class="w-16 h-16 bg-green-100 rounded-full flex items-center justify-center mx-auto mb-4">
                        <i data-lucide="check" class="text-green-600 w-8 h-8"></i>
                    </div>
                    <h3 class="text-lg font-semibold text-gray-800 mb-2">Payment Successful!</h3>
                    <p class="text-gray-600" id="successMessage"></p>
                </div>
            </div>
        </div>
    </div>

    <!-- Profile Settings Modal -->
    <div id="profileModal" class="modal">
        <div class="bg-white rounded-xl shadow-xl w-full max-w-md max-h-[90vh] overflow-y-auto m-4">
            <div class="flex items-center justify-between p-6 border-b">
                <h2 class="text-xl font-bold text-gray-800">Profile Settings</h2>
                <button id="closeProfile" class="p-2 hover:bg-gray-100 rounded-full transition-colors">
                    <i data-lucide="x" class="w-5 h-5"></i>
                </button>
            </div>
            <div class="p-6">
                <div class="text-center mb-6">
                    <div class="relative inline-block">
                        <img id="profileImageDisplay" class="w-24 h-24 rounded-full object-cover border-4 border-gray-200" src="https://images.pexels.com/photos/1043471/pexels-photo-1043471.jpeg?auto=compress&cs=tinysrgb&w=150&h=150&fit=crop" alt="Profile">
                        <label for="profileImageEdit" class="absolute bottom-0 right-0 p-2 bg-pink-500 rounded-full text-white cursor-pointer hover:bg-pink-600 transition-colors">
                            <i data-lucide="upload" class="w-4 h-4"></i>
                        </label>
                        <input type="file" id="profileImageEdit" accept="image/*" class="hidden">
                    </div>
                </div>

                <form id="profileForm" class="space-y-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Full Name</label>
                        <input 
                            type="text" 
                            id="profileName" 
                            name="profileName"
                            class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-pink-500 focus:border-transparent"
                        >
                    </div>

                    <div class="grid grid-cols-2 gap-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Age</label>
                            <input 
                                type="number" 
                                id="profileAge" 
                                name="profileAge"
                                min="18" 
                                max="100"
                                class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-pink-500 focus:border-transparent"
                            >
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Height</label>
                            <input 
                                type="text" 
                                id="profileHeight" 
                                name="profileHeight"
                                class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-pink-500 focus:border-transparent"
                            >
                        </div>
                    </div>

                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Country</label>
                        <input 
                            type="text" 
                            id="profileCountry" 
                            name="profileCountry"
                            class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-pink-500 focus:border-transparent"
                        >
                    </div>

                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Email</label>
                        <input 
                            type="email" 
                            id="profileEmail" 
                            name="profileEmail"
                            readonly 
                            class="w-full px-4 py-3 border border-gray-300 rounded-lg bg-gray-100 text-gray-600"
                        >
                    </div>

                    <div class="flex gap-3">
                        <button type="submit" class="flex-1 bg-gradient-to-r from-pink-500 to-purple-600 text-white py-3 rounded-lg font-medium hover:from-pink-600 hover:to-purple-700 transition-all">
                            <i data-lucide="check" class="w-4 h-4 inline mr-2"></i>
                            Save Changes
                        </button>
                        <button type="button" id="cancelProfile" class="bg-gray-200 text-gray-800 hover:bg-gray-300 px-6 py-3 rounded-lg font-medium transition-colors">
                            Cancel
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Transaction History Modal -->
    <div id="transactionModal" class="modal">
        <div class="bg-white rounded-xl shadow-xl w-full max-w-md max-h-[90vh] overflow-y-auto m-4">
            <div class="flex items-center justify-between p-6 border-b">
                <h2 class="text-xl font-bold text-gray-800">Transaction History</h2>
                <button id="closeTransaction" class="p-2 hover:bg-gray-100 rounded-full transition-colors">
                    <i data-lucide="x" class="w-5 h-5"></i>
                </button>
            </div>
            <div class="p-6">
                <div id="transactionList" class="space-y-4">
                    <!-- Transactions will be populated here -->
                </div>
                <div id="noTransactions" class="text-center py-8 text-gray-500">
                    <i data-lucide="credit-card" class="w-12 h-12 mx-auto mb-4 text-gray-300"></i>
                    <p>No transactions yet</p>
                </div>
            </div>
        </div>
    </div>

    <!-- Support Modal -->
    <div id="supportModal" class="modal">
        <div class="bg-white rounded-xl shadow-xl w-full max-w-md max-h-[90vh] overflow-y-auto m-4">
            <div class="flex items-center justify-between p-6 border-b">
                <h2 class="text-xl font-bold text-gray-800">Support</h2>
                <button id="closeSupport" class="p-2 hover:bg-gray-100 rounded-full transition-colors">
                    <i data-lucide="x" class="w-5 h-5"></i>
                </button>
            </div>
            <div class="p-6">
                <div class="space-y-6">
                    <div>
                        <h3 class="font-semibold text-gray-800 mb-3">Frequently Asked Questions</h3>
                        <div class="space-y-3">
                            <div class="border rounded-lg p-3">
                                <h4 class="font-medium text-gray-800">How do I buy credits?</h4>
                                <p class="text-sm text-gray-600 mt-1">Click on "Buy Credits" and follow the payment instructions using M-Pesa.</p>
                            </div>
                            <div class="border rounded-lg p-3">
                                <h4 class="font-medium text-gray-800">How do I send messages?</h4>
                                <p class="text-sm text-gray-600 mt-1">You need credits to send messages. Each message costs 1 credit.</p>
                            </div>
                            <div class="border rounded-lg p-3">
                                <h4 class="font-medium text-gray-800">What is unlimited messaging?</h4>
                                <p class="text-sm text-gray-600 mt-1">With unlimited messaging, you can send as many messages as you want for 30 days.</p>
                            </div>
                        </div>
                    </div>

                    <div>
                        <h3 class="font-semibold text-gray-800 mb-3">Contact Us</h3>
                        <div class="space-y-2">
                            <p class="text-sm text-gray-600">
                                <i data-lucide="mail" class="w-4 h-4 inline mr-2"></i>
                                support@zurilove.com
                            </p>
                            <p class="text-sm text-gray-600">
                                <i data-lucide="phone" class="w-4 h-4 inline mr-2"></i>
                                +1 (555) 123-4567
                            </p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Notifications Modal -->
    <div id="notificationsModal" class="modal">
        <div class="bg-white rounded-xl shadow-xl w-full max-w-md max-h-[90vh] overflow-y-auto m-4">
            <div class="flex items-center justify-between p-6 border-b">
                <h2 class="text-xl font-bold text-gray-800">Notifications</h2>
                <button id="closeNotifications" class="p-2 hover:bg-gray-100 rounded-full transition-colors">
                    <i data-lucide="x" class="w-5 h-5"></i>
                </button>
            </div>
            <div class="p-6">
                <div id="notificationsList" class="space-y-4">
                    <!-- Notifications will be populated here -->
                </div>
                <div id="noNotifications" class="text-center py-8 text-gray-500">
                    <i data-lucide="bell" class="w-12 h-12 mx-auto mb-4 text-gray-300"></i>
                    <p>No notifications yet</p>
                </div>
            </div>
        </div>
    </div>

    <!-- Success Modal -->
    <div id="successModal" class="modal">
        <div class="bg-white rounded-xl shadow-xl w-full max-w-sm m-4">
            <div class="p-6 text-center">
                <div class="w-16 h-16 bg-green-100 rounded-full flex items-center justify-center mx-auto mb-4">
                    <i data-lucide="check" class="text-green-600 w-8 h-8"></i>
                </div>
                <h3 class="text-lg font-semibold text-gray-800 mb-2" id="successTitle">Success!</h3>
                <p class="text-gray-600 mb-6" id="successText"></p>
                <button id="closeSuccess" class="bg-gradient-to-r from-pink-500 to-purple-600 text-white px-6 py-3 rounded-lg font-medium hover:from-pink-600 hover:to-purple-700 transition-all">
                    OK
                </button>
            </div>
        </div>
    </div>

    <script>
        // Initialize Lucide icons
        lucide.createIcons();

        // Initialize EmailJS
        emailjs.init('LMdaXNTSTm33O5BqT');

        // Global variables
        let currentUser = null;
        let isLogin = true;
        let matches = [];
        let notifications = [];
        let transactions = [];
        let currentMatch = null;

        // Currency rates (relative to USD)
        const currencyRates = {
            'USD': 1,
            'EUR': 0.85,
            'GBP': 0.73,
            'KES': 129.50,
            'NGN': 461.50
        };

        const currencySymbols = {
            'USD': '$',
            'EUR': '€',
            'GBP': '£',
            'KES': 'KSh',
            'NGN': '₦'
        };

        // Sample matches data
        const sampleMatches = [
            {
                id: '1',
                name: 'Emma Rodriguez',
                age: 26,
                country: 'Spain',
                sex: 'female',
                profileImage: 'https://images.pexels.com/photos/1239291/pexels-photo-1239291.jpeg?auto=compress&cs=tinysrgb&w=300&h=400&fit=crop',
                isOnline: true,
                lastMessage: 'Hey there! How are you?',
                unreadCount: 0,
                hasLiked: false,
            },
            {
                id: '2',
                name: 'Sophie Chen',
                age: 24,
                country: 'Canada',
                sex: 'female',
                profileImage: 'https://images.pexels.com/photos/1222271/pexels-photo-1222271.jpeg?auto=compress&cs=tinysrgb&w=300&h=400&fit=crop',
                isOnline: true,
                lastMessage: 'Nice to meet you!',
                unreadCount: 0,
                hasLiked: false,
            },
            {
                id: '3',
                name: 'James Wilson',
                age: 29,
                country: 'United States',
                sex: 'male',
                profileImage: 'https://images.pexels.com/photos/1043474/pexels-photo-1043474.jpeg?auto=compress&cs=tinysrgb&w=300&h=400&fit=crop',
                isOnline: true,
                lastMessage: 'Hey! How\'s your day going?',
                unreadCount: 0,
                hasLiked: false,
            },
            {
                id: '4',
                name: 'Carlos Martinez',
                age: 31,
                country: 'Mexico',
                sex: 'male',
                profileImage: 'https://images.pexels.com/photos/1040880/pexels-photo-1040880.jpeg?auto=compress&cs=tinysrgb&w=300&h=400&fit=crop',
                isOnline: false,
                lastMessage: 'Nice profile!',
                unreadCount: 0,
                hasLiked: false,
            }
        ];

        // DOM Elements
        const authScreen = document.getElementById('authScreen');
        const mainScreen = document.getElementById('mainScreen');
        const chatScreen = document.getElementById('chatScreen');
        const authForm = document.getElementById('authForm');
        const switchModeBtn = document.getElementById('switchMode');
        const registrationFields = document.getElementById('registrationFields');
        const errorMessage = document.getElementById('errorMessage');
        const errorText = document.getElementById('errorText');

        // Initialize app
        document.addEventListener('DOMContentLoaded', function() {
            initializeApp();
            setupEventListeners();
            loadStoredData();
        });

        function initializeApp() {
            // Check if user is logged in
            const storedUser = localStorage.getItem('zuriLoveUser');
            if (storedUser) {
                currentUser = JSON.parse(storedUser);
                showMainScreen();
            } else {
                showAuthScreen();
            }
        }

        function setupEventListeners() {
            // Auth form events
            authForm.addEventListener('submit', handleAuthSubmit);
            switchModeBtn.addEventListener('click', toggleAuthMode);
            
            // Password toggle
            document.getElementById('togglePassword').addEventListener('click', togglePasswordVisibility);
            
            // Profile image upload
            document.getElementById('profileImage').addEventListener('change', handleProfileImageUpload);
            document.getElementById('profileImageEdit').addEventListener('change', handleProfileImageEdit);
            
            // Header buttons
            document.getElementById('buyCreditsBtn')?.addEventListener('click', () => showModal('buyCreditsModal'));
            document.getElementById('notificationsBtn')?.addEventListener('click', () => showModal('notificationsModal'));
            document.getElementById('profileBtn')?.addEventListener('click', () => showModal('profileModal'));
            document.getElementById('logoutBtn')?.addEventListener('click', handleLogout);
            
            // Mobile menu
            document.getElementById('mobileMenuBtn')?.addEventListener('click', toggleMobileMenu);
            document.getElementById('buyCreditsMenuBtn')?.addEventListener('click', () => {
                toggleMobileMenu();
                showModal('buyCreditsModal');
            });
            document.getElementById('profileMenuBtn')?.addEventListener('click', () => {
                toggleMobileMenu();
                showModal('profileModal');
            });
            document.getElementById('transactionMenuBtn')?.addEventListener('click', () => {
                toggleMobileMenu();
                showModal('transactionModal');
            });
            document.getElementById('supportMenuBtn')?.addEventListener('click', () => {
                toggleMobileMenu();
                showModal('supportModal');
            });
            document.getElementById('logoutMenuBtn')?.addEventListener('click', () => {
                toggleMobileMenu();
                handleLogout();
            });
            document.getElementById('notificationsBtnMobile')?.addEventListener('click', () => showModal('notificationsModal'));
            
            // Chat events
            document.getElementById('backToMatches')?.addEventListener('click', showMainScreen);
            document.getElementById('sendMessageBtn')?.addEventListener('click', sendMessage);
            document.getElementById('messageInput')?.addEventListener('keypress', function(e) {
                if (e.key === 'Enter' && !e.shiftKey) {
                    e.preventDefault();
                    sendMessage();
                }
            });
            document.getElementById('unlockChatBtn')?.addEventListener('click', () => showModal('buyCreditsModal'));
            
            // Modal close events
            setupModalEvents();
            
            // Buy credits events
            setupBuyCreditsEvents();
            
            // Profile form events
            setupProfileEvents();
            
            // Auto-resize textarea
            const messageInput = document.getElementById('messageInput');
            if (messageInput) {
                messageInput.addEventListener('input', function() {
                    this.style.height = 'auto';
                    this.style.height = Math.min(this.scrollHeight, 120) + 'px';
                });
            }
            
            // Close dropdowns when clicking outside
            document.addEventListener('click', function(e) {
                if (!e.target.closest('#mobileMenuBtn') && !e.target.closest('#mobileMenu')) {
                    document.getElementById('mobileMenu').classList.remove('show');
                }
            });
        }

        function setupModalEvents() {
            // Close modal buttons
            document.getElementById('closeBuyCredits')?.addEventListener('click', () => hideModal('buyCreditsModal'));
            document.getElementById('closeProfile')?.addEventListener('click', () => hideModal('profileModal'));
            document.getElementById('closeTransaction')?.addEventListener('click', () => hideModal('transactionModal'));
            document.getElementById('closeSupport')?.addEventListener('click', () => hideModal('supportModal'));
            document.getElementById('closeNotifications')?.addEventListener('click', () => hideModal('notificationsModal'));
            document.getElementById('closeSuccess')?.addEventListener('click', () => hideModal('successModal'));
            
            // Close modals when clicking outside
            document.querySelectorAll('.modal').forEach(modal => {
                modal.addEventListener('click', function(e) {
                    if (e.target === this) {
                        this.classList.remove('show');
                    }
                });
            });
        }

        function setupBuyCreditsEvents() {
            // Package selection
            document.querySelectorAll('[data-package]').forEach(packageEl => {
                packageEl.addEventListener('click', function() {
                    const packageId = this.dataset.package;
                    selectPackage(packageId);
                });
            });
            
            // Currency change
            document.getElementById('currencySelect')?.addEventListener('change', updatePrices);
            
            // Payment form
            document.getElementById('confirmPayment')?.addEventListener('click', processPayment);
            document.getElementById('backToPackages')?.addEventListener('click', showPackageSelection);
            document.getElementById('cancelBuyCredits')?.addEventListener('click', () => hideModal('buyCreditsModal'));
        }

        function setupProfileEvents() {
            document.getElementById('profileForm')?.addEventListener('submit', function(e) {
                e.preventDefault();
                saveProfile();
            });
            document.getElementById('cancelProfile')?.addEventListener('click', () => hideModal('profileModal'));
        }

        function handleAuthSubmit(e) {
            e.preventDefault();
            
            const email = document.getElementById('email').value.trim();
            const password = document.getElementById('password').value.trim();
            
            if (!email || !password) {
                showError('Please fill in all required fields');
                return;
            }
            
            if (isLogin) {
                // Login logic
                const users = JSON.parse(localStorage.getItem('zuriLoveUsers') || '[]');
                const user = users.find(u => u.email === email && u.password === password);
                
                if (user) {
                    currentUser = user;
                    localStorage.setItem('zuriLoveUser', JSON.stringify(user));
                    showMainScreen();
                } else {
                    showError('Invalid email or password');
                }
            } else {
                // Registration logic
                const formData = new FormData(authForm);
                const userData = Object.fromEntries(formData.entries());
                
                // Validate required fields
                const requiredFields = ['email', 'password', 'fullName', 'age', 'height', 'country', 'countryCode', 'phoneNumber', 'sex', 'lookingFor', 'relationshipStatus', 'relationshipType'];
                const missingFields = requiredFields.filter(field => !userData[field]);
                
                if (missingFields.length > 0) {
                    showError('Please fill in all required fields');
                    return;
                }
                
                // Check if email already exists
                const users = JSON.parse(localStorage.getItem('zuriLoveUsers') || '[]');
                if (users.find(u => u.email === email)) {
                    showError('Email already exists');
                    return;
                }
                
                // Create new user with 0 credits
                const newUser = {
                    id: Date.now().toString(),
                    email: userData.email,
                    password: userData.password,
                    name: userData.fullName,
                    age: parseInt(userData.age),
                    height: userData.height,
                    country: userData.country,
                    countryCode: userData.countryCode,
                    phoneNumber: userData.phoneNumber,
                    sex: userData.sex,
                    lookingFor: userData.lookingFor,
                    relationshipStatus: userData.relationshipStatus,
                    relationshipType: userData.relationshipType,
                    profileImage: document.getElementById('previewImg')?.src || '',
                    credits: 0,
                    isOnline: true,
                    hasUnlimitedMessages: false,
                    unlimitedUntil: null
                };
                
                users.push(newUser);
                localStorage.setItem('zuriLoveUsers', JSON.stringify(users));
                
                currentUser = newUser;
                localStorage.setItem('zuriLoveUser', JSON.stringify(newUser));
                
                // Send registration email
                sendRegistrationEmail(newUser);
                
                showMainScreen();
            }
        }

        function toggleAuthMode() {
            isLogin = !isLogin;
            
            if (isLogin) {
                document.getElementById('authSubtitle').textContent = 'Welcome back!';
                document.getElementById('submitText').textContent = 'Sign In';
                document.getElementById('switchText').textContent = "Don't have an account?";
                document.getElementById('switchButton').textContent = 'Sign Up';
                registrationFields.classList.add('hidden');
            } else {
                document.getElementById('authSubtitle').textContent = 'Find your perfect match';
                document.getElementById('submitText').textContent = 'Create Account';
                document.getElementById('switchText').textContent = 'Already have an account?';
                document.getElementById('switchButton').textContent = 'Sign In';
                registrationFields.classList.remove('hidden');
            }
            
            hideError();
        }

        function togglePasswordVisibility() {
            const passwordInput = document.getElementById('password');
            const toggleBtn = document.getElementById('togglePassword');
            const icon = toggleBtn.querySelector('i');
            
            if (passwordInput.type === 'password') {
                passwordInput.type = 'text';
                icon.setAttribute('data-lucide', 'eye-off');
            } else {
                passwordInput.type = 'password';
                icon.setAttribute('data-lucide', 'eye');
            }
            
            lucide.createIcons();
        }

        function handleProfileImageUpload(e) {
            const file = e.target.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    const previewImg = document.getElementById('previewImg');
                    const imagePreview = document.getElementById('imagePreview');
                    const uploadPlaceholder = document.getElementById('uploadPlaceholder');
                    
                    previewImg.src = e.target.result;
                    imagePreview.classList.remove('hidden');
                    uploadPlaceholder.classList.add('hidden');
                };
                reader.readAsDataURL(file);
            }
        }

        function handleProfileImageEdit(e) {
            const file = e.target.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    document.getElementById('profileImageDisplay').src = e.target.result;
                    showSuccessMessage('Profile image updated! Changes will be reviewed.');
                };
                reader.readAsDataURL(file);
            }
        }

        function showError(message) {
            errorText.textContent = message;
            errorMessage.classList.remove('hidden');
        }

        function hideError() {
            errorMessage.classList.add('hidden');
        }

        function showAuthScreen() {
            authScreen.classList.remove('hidden');
            mainScreen.classList.add('hidden');
            chatScreen.classList.add('hidden');
        }

        function showMainScreen() {
            authScreen.classList.add('hidden');
            mainScreen.classList.remove('hidden');
            chatScreen.classList.add('hidden');
            
            updateUserDisplay();
            loadMatches();
            // Don't generate notifications for new users
        }

        function showChatScreen(match) {
            currentMatch = match;
            authScreen.classList.add('hidden');
            mainScreen.classList.add('hidden');
            chatScreen.classList.remove('hidden');
            
            setupChatScreen(match);
        }

        function updateUserDisplay() {
            if (!currentUser) return;
            
            const creditsDisplay = currentUser.hasUnlimitedMessages && 
                currentUser.unlimitedUntil && 
                currentUser.unlimitedUntil > Date.now() ? '∞' : currentUser.credits;
            
            document.getElementById('creditsDisplay').textContent = creditsDisplay;
            document.getElementById('creditsMobile').textContent = creditsDisplay === '∞' ? 'Unlimited' : creditsDisplay;
            
            // Update profile form
            if (document.getElementById('profileName')) {
                document.getElementById('profileName').value = currentUser.name || '';
                document.getElementById('profileAge').value = currentUser.age || '';
                document.getElementById('profileHeight').value = currentUser.height || '';
                document.getElementById('profileCountry').value = currentUser.country || '';
                document.getElementById('profileEmail').value = currentUser.email || '';
            }
        }

        function loadMatches() {
            if (!currentUser) return;
            
            // Filter matches based on user preferences
            matches = sampleMatches.filter(match => match.sex === currentUser.lookingFor);
            
            const matchesGrid = document.getElementById('matchesGrid');
            const matchesCount = document.getElementById('matchesCount');
            
            matchesCount.textContent = `${matches.length} people are waiting to meet you`;
            
            matchesGrid.innerHTML = matches.map(match => `
                <div class="bg-white rounded-xl shadow-lg overflow-hidden hover:shadow-xl transition-all duration-300 hover:-translate-y-1">
                    <div class="relative">
                        <img src="${match.profileImage}" alt="${match.name}" class="w-full h-48 object-cover">
                        ${match.isOnline ? '<div class="absolute top-3 right-3 w-3 h-3 bg-green-500 rounded-full border-2 border-white animate-pulse"></div>' : ''}
                        ${match.unreadCount > 0 ? `<div class="absolute top-3 left-3 bg-red-500 text-white text-xs rounded-full w-6 h-6 flex items-center justify-center animate-pulse">${match.unreadCount}</div>` : ''}
                        ${match.hasLiked ? '<div class="absolute bottom-3 right-3 bg-pink-500 text-white rounded-full p-2"><i data-lucide="heart" class="w-4 h-4"></i></div>' : ''}
                    </div>
                    
                    <div class="p-4">
                        <h3 class="text-lg font-semibold text-gray-800 mb-1">${match.name}</h3>
                        <p class="text-sm text-gray-600 mb-3 flex items-center gap-1">
                            <i data-lucide="users" class="w-3 h-3"></i>
                            ${match.age} • ${match.country}
                        </p>
                        
                        ${match.lastMessage ? `
                            <div class="bg-gray-50 rounded-lg p-3 mb-3">
                                <p class="text-sm text-gray-600 line-clamp-2">${match.lastMessage}</p>
                            </div>
                        ` : ''}
                        
                        <div class="flex gap-2">
                            <button onclick="openChat('${match.id}')" class="flex-1 bg-gradient-to-r from-pink-500 to-purple-600 text-white px-4 py-2 rounded-lg font-medium hover:from-pink-600 hover:to-purple-700 transition-all flex items-center justify-center gap-2">
                                <i data-lucide="message-circle" class="w-4 h-4"></i>
                                ${hasCreditsOrUnlimited() ? 'Chat' : 'Unlock Chat'}
                            </button>
                            <button onclick="likeMatch('${match.id}')" class="bg-gray-200 text-gray-800 hover:bg-gray-300 p-2 rounded-lg transition-colors ${match.hasLiked ? 'bg-pink-500 text-white hover:bg-pink-600' : ''}">
                                <i data-lucide="heart" class="w-4 h-4 ${match.hasLiked ? 'fill-current' : ''}"></i>
                            </button>
                        </div>
                    </div>
                </div>
            `).join('');
            
            lucide.createIcons();
        }

        function openChat(matchId) {
            const match = matches.find(m => m.id === matchId);
            if (match) {
                showChatScreen(match);
            }
        }

        function likeMatch(matchId) {
            if (!hasCreditsOrUnlimited()) {
                showModal('buyCreditsModal');
                return;
            }
            
            const matchIndex = matches.findIndex(m => m.id === matchId);
            if (matchIndex !== -1) {
                matches[matchIndex].hasLiked = !matches[matchIndex].hasLiked;
                
                // Deduct credit if not unlimited
                if (!currentUser.hasUnlimitedMessages) {
                    currentUser.credits = Math.max(0, currentUser.credits - 1);
                    updateUserInStorage();
                }
                
                loadMatches();
                updateUserDisplay();
            }
        }

        function setupChatScreen(match) {
            document.getElementById('chatUserImage').src = match.profileImage;
            document.getElementById('chatUserName').textContent = match.name;
            document.getElementById('chatUserStatus').textContent = match.isOnline ? 'Online' : 'Offline';
            
            if (match.isOnline) {
                document.getElementById('chatUserOnline').classList.remove('hidden');
            } else {
                document.getElementById('chatUserOnline').classList.add('hidden');
            }
            
            const hasCredits = hasCreditsOrUnlimited();
            const chatMessages = document.getElementById('chatMessages');
            const chatLocked = document.getElementById('chatLocked');
            const chatInput = document.getElementById('chatInput');
            
            if (hasCredits) {
                chatMessages.classList.remove('hidden');
                chatInput.classList.remove('hidden');
                chatLocked.classList.add('hidden');
                
                // Load sample messages
                chatMessages.innerHTML = `
                    <div class="flex justify-end">
                        <div class="bg-gradient-to-r from-pink-500 to-purple-600 text-white px-4 py-2 rounded-2xl max-w-xs">
                            <p class="text-sm">Hey! Nice to meet you</p>
                            <p class="text-xs opacity-75 mt-1">12:34 PM</p>
                        </div>
                    </div>
                    <div class="flex justify-start">
                        <div class="bg-white border px-4 py-2 rounded-2xl max-w-xs">
                            <p class="text-sm text-gray-800">${match.lastMessage || 'Hi there!'}</p>
                            <p class="text-xs text-gray-500 mt-1">12:35 PM</p>
                        </div>
                    </div>
                `;
            } else {
                chatMessages.classList.add('hidden');
                chatInput.classList.add('hidden');
                chatLocked.classList.remove('hidden');
            }
        }

        function sendMessage() {
            const messageInput = document.getElementById('messageInput');
            const message = messageInput.value.trim();
            
            if (!message || !hasCreditsOrUnlimited()) return;
            
            // Add message to chat
            const chatMessages = document.getElementById('chatMessages');
            const messageEl = document.createElement('div');
            messageEl.className = 'flex justify-end';
            messageEl.innerHTML = `
                <div class="bg-gradient-to-r from-pink-500 to-purple-600 text-white px-4 py-2 rounded-2xl max-w-xs">
                    <p class="text-sm">${message}</p>
                    <p class="text-xs opacity-75 mt-1">${new Date().toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'})}</p>
                </div>
            `;
            chatMessages.appendChild(messageEl);
            
            // Clear input
            messageInput.value = '';
            messageInput.style.height = 'auto';
            
            // Deduct credit if not unlimited
            if (!currentUser.hasUnlimitedMessages) {
                currentUser.credits = Math.max(0, currentUser.credits - 1);
                updateUserInStorage();
                updateUserDisplay();
                
                // Check if user ran out of credits
                if (currentUser.credits === 0) {
                    setTimeout(() => {
                        showModal('buyCreditsModal');
                    }, 1000);
                }
            }
            
            // Scroll to bottom
            chatMessages.scrollTop = chatMessages.scrollHeight;
        }

        function hasCreditsOrUnlimited() {
            if (!currentUser) return false;
            
            if (currentUser.hasUnlimitedMessages && 
                currentUser.unlimitedUntil && 
                currentUser.unlimitedUntil > Date.now()) {
                return true;
            }
            return currentUser.credits > 0;
        }

        function showModal(modalId) {
            const modal = document.getElementById(modalId);
            if (modal) {
                modal.classList.add('show');
                
                // Load modal content based on type
                if (modalId === 'profileModal') {
                    loadProfileData();
                } else if (modalId === 'transactionModal') {
                    loadTransactionHistory();
                } else if (modalId === 'notificationsModal') {
                    loadNotifications();
                } else if (modalId === 'buyCreditsModal') {
                    resetBuyCreditsModal();
                }
            }
        }

        function hideModal(modalId) {
            const modal = document.getElementById(modalId);
            if (modal) {
                modal.classList.remove('show');
            }
        }

        function toggleMobileMenu() {
            const mobileMenu = document.getElementById('mobileMenu');
            mobileMenu.classList.toggle('show');
        }

        function resetBuyCreditsModal() {
            document.getElementById('buyCreditsContent').classList.remove('hidden');
            document.getElementById('paymentForm').classList.add('hidden');
            document.getElementById('paymentSuccess').classList.add('hidden');
            document.getElementById('transactionId').value = '';
            document.getElementById('paymentError').classList.add('hidden');
            updatePrices();
        }

        function updatePrices() {
            const selectedCurrency = document.getElementById('currencySelect').value;
            const rate = currencyRates[selectedCurrency];
            const symbol = currencySymbols[selectedCurrency];
            
            document.querySelectorAll('[data-price]').forEach(priceEl => {
                const usdPrice = parseFloat(priceEl.dataset.price);
                const localPrice = (usdPrice * rate).toFixed(2);
                priceEl.textContent = `${symbol}${localPrice}`;
            });
        }

        function selectPackage(packageId) {
            const packages = {
                '1': { name: '10 Credits', credits: 10, price: 1 },
                '2': { name: 'Unlimited Messages (1 Month)', credits: 0, price: 5, unlimited: true },
                '3': { name: 'Unlimited Messages (1 Month Premium)', credits: 0, price: 10, unlimited: true }
            };
            
            const selectedPackage = packages[packageId];
            const selectedCurrency = document.getElementById('currencySelect').value;
            const rate = currencyRates[selectedCurrency];
            const symbol = currencySymbols[selectedCurrency];
            const localPrice = (selectedPackage.price * rate).toFixed(2);
            
            document.getElementById('selectedPackageName').textContent = selectedPackage.name;
            document.getElementById('selectedPackagePrice').textContent = `${symbol}${localPrice}`;
            document.getElementById('paymentAmount').textContent = `${symbol}${localPrice}`;
            
            // Store selected package data
            document.getElementById('confirmPayment').dataset.packageId = packageId;
            document.getElementById('confirmPayment').dataset.price = localPrice;
            document.getElementById('confirmPayment').dataset.currency = selectedCurrency;
            
            // Show payment form
            document.getElementById('buyCreditsContent').classList.add('hidden');
            document.getElementById('paymentForm').classList.remove('hidden');
        }

        function showPackageSelection() {
            document.getElementById('buyCreditsContent').classList.remove('hidden');
            document.getElementById('paymentForm').classList.add('hidden');
            document.getElementById('paymentSuccess').classList.add('hidden');
        }

        function processPayment() {
            const transactionId = document.getElementById('transactionId').value.trim();
            
            if (!transactionId) {
                showPaymentError('Please enter transaction ID');
                return;
            }
            
            if (transactionId.length < 8) {
                showPaymentError('Invalid transaction ID. Please check and try again.');
                return;
            }
            
            const packageId = document.getElementById('confirmPayment').dataset.packageId;
            const price = document.getElementById('confirmPayment').dataset.price;
            const currency = document.getElementById('confirmPayment').dataset.currency;
            
            // Process payment
            if (packageId === '1') {
                currentUser.credits += 10;
            } else {
                currentUser.hasUnlimitedMessages = true;
                currentUser.unlimitedUntil = Date.now() + (30 * 24 * 60 * 60 * 1000); // 30 days
            }
            
            // Add transaction to history
            const transaction = {
                id: Date.now().toString(),
                packageName: document.getElementById('selectedPackageName').textContent,
                amount: `${currencySymbols[currency]}${price}`,
                currency: currency,
                date: new Date().toLocaleDateString(),
                status: 'Completed'
            };
            
            transactions.push(transaction);
            localStorage.setItem('zuriLoveTransactions', JSON.stringify(transactions));
            
            updateUserInStorage();
            updateUserDisplay();
            
            // Send payment email
            sendPaymentEmail(currentUser, transaction);
            
            // Show success
            const successMessage = packageId === '1' 
                ? '10 credits have been added to your account'
                : 'Unlimited messages activated for 1 month!';
            
            document.getElementById('successMessage').textContent = successMessage;
            document.getElementById('paymentForm').classList.add('hidden');
            document.getElementById('paymentSuccess').classList.remove('hidden');
            
            setTimeout(() => {
                hideModal('buyCreditsModal');
            }, 3000);
        }

        function showPaymentError(message) {
            document.getElementById('paymentErrorText').textContent = message;
            document.getElementById('paymentError').classList.remove('hidden');
        }

        function loadProfileData() {
            if (!currentUser) return;
            
            document.getElementById('profileName').value = currentUser.name || '';
            document.getElementById('profileAge').value = currentUser.age || '';
            document.getElementById('profileHeight').value = currentUser.height || '';
            document.getElementById('profileCountry').value = currentUser.country || '';
            document.getElementById('profileEmail').value = currentUser.email || '';
            
            if (currentUser.profileImage) {
                document.getElementById('profileImageDisplay').src = currentUser.profileImage;
            }
        }

        function saveProfile() {
            const formData = new FormData(document.getElementById('profileForm'));
            
            currentUser.name = formData.get('profileName');
            currentUser.age = parseInt(formData.get('profileAge'));
            currentUser.height = formData.get('profileHeight');
            currentUser.country = formData.get('profileCountry');
            
            updateUserInStorage();
            hideModal('profileModal');
            showSuccessMessage('Profile updated successfully!');
        }

        function loadTransactionHistory() {
            const transactionList = document.getElementById('transactionList');
            const noTransactions = document.getElementById('noTransactions');
            
            if (transactions.length === 0) {
                transactionList.classList.add('hidden');
                noTransactions.classList.remove('hidden');
            } else {
                transactionList.classList.remove('hidden');
                noTransactions.classList.add('hidden');
                
                transactionList.innerHTML = transactions.map(transaction => `
                    <div class="border rounded-lg p-4">
                        <div class="flex justify-between items-start mb-2">
                            <h4 class="font-semibold text-gray-800">${transaction.packageName}</h4>
                            <span class="text-green-600 text-sm font-medium">${transaction.status}</span>
                        </div>
                        <p class="text-gray-600 text-sm">Amount: ${transaction.amount}</p>
                        <p class="text-gray-600 text-sm">Date: ${transaction.date}</p>
                    </div>
                `).join('');
            }
        }

        function loadNotifications() {
            const notificationsList = document.getElementById('notificationsList');
            const noNotifications = document.getElementById('noNotifications');
            
            if (notifications.length === 0) {
                notificationsList.classList.add('hidden');
                noNotifications.classList.remove('hidden');
            } else {
                notificationsList.classList.remove('hidden');
                noNotifications.classList.add('hidden');
                
                notificationsList.innerHTML = notifications.map(notification => `
                    <div class="border rounded-lg p-4 ${notification.isRead ? 'bg-gray-50' : 'bg-blue-50'}">
                        <div class="flex items-start gap-3">
                            <div class="w-8 h-8 rounded-full flex items-center justify-center ${notification.type === 'message' ? 'bg-blue-100' : 'bg-pink-100'}">
                                <i data-lucide="${notification.type === 'message' ? 'message-circle' : 'heart'}" class="w-4 h-4 ${notification.type === 'message' ? 'text-blue-600' : 'text-pink-600'}"></i>
                            </div>
                            <div class="flex-1">
                                <h4 class="font-semibold text-gray-800">${notification.title}</h4>
                                <p class="text-gray-600 text-sm">${notification.message}</p>
                                <p class="text-gray-500 text-xs mt-1">${new Date(notification.timestamp).toLocaleString()}</p>
                            </div>
                        </div>
                    </div>
                `).join('');
                
                // Mark all as read
                notifications.forEach(n => n.isRead = true);
                localStorage.setItem('zuriLoveNotifications', JSON.stringify(notifications));
                updateNotificationBadge();
                
                lucide.createIcons();
            }
        }

        function updateNotificationBadge() {
            const unreadCount = notifications.filter(n => !n.isRead).length;
            const badge = document.getElementById('notificationBadge');
            const badgeMobile = document.getElementById('notificationBadgeMobile');
            
            if (unreadCount > 0) {
                badge.textContent = unreadCount;
                badge.classList.remove('hidden');
                badgeMobile.textContent = unreadCount;
                badgeMobile.classList.remove('hidden');
            } else {
                badge.classList.add('hidden');
                badgeMobile.classList.add('hidden');
            }
        }

        function updateUserInStorage() {
            localStorage.setItem('zuriLoveUser', JSON.stringify(currentUser));
            
            // Also update in users array
            const users = JSON.parse(localStorage.getItem('zuriLoveUsers') || '[]');
            const userIndex = users.findIndex(u => u.id === currentUser.id);
            if (userIndex !== -1) {
                users[userIndex] = currentUser;
                localStorage.setItem('zuriLoveUsers', JSON.stringify(users));
            }
        }

        function loadStoredData() {
            // Load transactions
            const storedTransactions = localStorage.getItem('zuriLoveTransactions');
            if (storedTransactions) {
                transactions = JSON.parse(storedTransactions);
            }
            
            // Load notifications
            const storedNotifications = localStorage.getItem('zuriLoveNotifications');
            if (storedNotifications) {
                notifications = JSON.parse(storedNotifications);
                updateNotificationBadge();
            }
        }

        function handleLogout() {
            currentUser = null;
            localStorage.removeItem('zuriLoveUser');
            showAuthScreen();
        }

        function showSuccessMessage(message) {
            document.getElementById('successTitle').textContent = 'Success!';
            document.getElementById('successText').textContent = message;
            showModal('successModal');
        }

        // Email functions
        function sendRegistrationEmail(userData) {
            const templateParams = {
                user_name: userData.name,
                user_email: userData.email,
                user_age: userData.age,
                user_height: userData.height,
                user_country: userData.country,
                user_phone: userData.countryCode + userData.phoneNumber,
                user_sex: userData.sex,
                relationship_status: userData.relationshipStatus,
                looking_for: userData.lookingFor,
                relationship_type: userData.relationshipType,
            };

            emailjs.send('service_7e51cwp', 'template_sf4bm9j', templateParams, 'LMdaXNTSTm33O5BqT')
                .then(() => {
                    console.log('Registration email sent successfully');
                })
                .catch((error) => {
                    console.error('Failed to send registration email:', error);
                });
        }

        function sendPaymentEmail(user, transaction) {
            const templateParams = {
                user_name: user.name,
                user_email: user.email,
                user_phone: user.countryCode + user.phoneNumber,
                package_name: transaction.packageName,
                amount_paid: transaction.amount,
                transaction_id: 'MPESA' + Date.now(),
                currency: transaction.currency,
            };

            emailjs.send('service_7e51cwp', 'template_6rl4ss2', templateParams, 'LMdaXNTSTm33O5BqT')
                .then(() => {
                    console.log('Payment email sent successfully');
                })
                .catch((error) => {
                    console.error('Failed to send payment email:', error);
                });
        }
    </script>
</body>
</html>
